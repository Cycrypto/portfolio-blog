# Tiptap ë¦¬íŒ©í† ë§ v3.1 íŒ¨ì¹˜ ë…¸íŠ¸ - í”„ë¡œë•ì…˜ ì´ìŠˆ ìˆ˜ì •

## ğŸ“‹ ë¬¸ì„œ ì •ë³´

- **ì‘ì„±ì¼**: 2025-12-30
- **ë²„ì „**: 3.1 (v3.0 í”„ë¡œë•ì…˜ ì´ìŠˆ ìˆ˜ì •)
- **ì´ì „ ë²„ì „**: 3.0
- **íŒ¨ì¹˜ ëª©ì **: High-priority í”„ë¡œë•ì…˜ ë¸”ë¡œì»¤ í•´ê²°

---

## ğŸ¯ íŒ¨ì¹˜ ê°œìš”

v3.0ì—ì„œ ì‹ë³„ëœ **í”„ë¡œë•ì…˜ ë°°í¬ ì‹œ ì¹˜ëª…ì  ë¬¸ì œ**ë“¤ì„ í•´ê²°í•©ë‹ˆë‹¤.

### High Priority (MUST FIX - ë°°í¬ ë¸”ë¡œì»¤)

| ì´ìŠˆ ID | ë¬¸ì œ | ì˜í–¥ë„ | ìƒíƒœ |
|---------|------|--------|------|
| **A** | TOC ì•µì»¤ ë§í¬ ì‘ë™ ë¶ˆê°€ | âš ï¸ ê¸°ëŠ¥ ì¤‘ë‹¨ | ğŸ”§ ìˆ˜ì • |
| **B** | Cookie + Bearer ì¸ì¦ ë¶ˆì¼ì¹˜ | âš ï¸ ë³´ì•ˆ/êµ¬ì¡° | ğŸ”§ ìˆ˜ì • |
| **C** | Edge Runtime crypto ì˜¤ë¥˜ | âš ï¸ ëŸ°íƒ€ì„ ì—ëŸ¬ | ğŸ”§ ìˆ˜ì • |
| **D** | CSP nonce ë¯¸ì ìš© | âš ï¸ ë³´ì•ˆ ë¬´ë ¥í™” | ğŸ”§ ìˆ˜ì • |
| **E** | í•œêµ­ì–´ ê²€ìƒ‰ ì‹¤íŒ¨ | âš ï¸ í•µì‹¬ ê¸°ëŠ¥ ì‹¤íŒ¨ | ğŸ”§ ìˆ˜ì • |

### Medium Priority (ê¶Œì¥ ìˆ˜ì •)

| ì´ìŠˆ ID | ë¬¸ì œ | ìƒíƒœ |
|---------|------|------|
| **F** | DOMPurify í”„ë¡œí† ì½œ ë¯¸ì œí•œ | ğŸ“ ê°œì„  |
| **G** | Markdown ë Œë”ë§ í’ˆì§ˆ | ğŸ“ ê°œì„  |
| **H** | contentJson íƒ€ì… ì•ˆì „ì„± | ğŸ“ ê°œì„  |
| **I** | ìºì‹œ ë°±í•„ ê²½í•© ì¡°ê±´ | ğŸ“ ê°œì„  |

---

## ğŸ”§ Issue A: TOC ì•µì»¤ ID ì£¼ì…

### ë¬¸ì œ ë¶„ì„

**í˜„ìƒ**:
```typescript
// âŒ v3.0: extractHeadings()ê°€ IDë§Œ ìƒì„±
headings = [
  { level: 2, text: "ì†Œê°œ", id: "ì†Œê°œ" }
]

// âŒ ì‹¤ì œ HTMLì—ëŠ” IDê°€ ì—†ìŒ
<h2>ì†Œê°œ</h2>  // id ì†ì„± ì—†ìŒ

// âŒ TOC ë§í¬ëŠ” ì‘ë™í•˜ì§€ ì•ŠìŒ
<a href="#ì†Œê°œ">ì†Œê°œ</a> â†’ 404 anchor not found
```

**ê·¼ë³¸ ì›ì¸**:
- `extractHeadings()`ëŠ” IDë¥¼ **ê³„ì‚°ë§Œ í•˜ê³  ì‹¤ì œ HTMLì— ì£¼ì…í•˜ì§€ ì•ŠìŒ**
- `generateHTML()` â†’ DOMPurifyëŠ” ê¸°ë³¸ì ìœ¼ë¡œ IDë¥¼ ì¶”ê°€í•˜ì§€ ì•ŠìŒ

### í•´ê²° ë°©ì•ˆ ê²°ì • íŠ¸ë¦¬

```
TOC ì•µì»¤ ID ì£¼ì… ë°©ë²• ì„ íƒ
â”œâ”€ ë°©ë²• 1: Tiptap Heading Extension ì»¤ìŠ¤í„°ë§ˆì´ì§• âœ… ê¶Œì¥
â”‚  â”œâ”€ ì¥ì : JSON ì €ì¥ ì‹œì ì— ID í¬í•¨, HTML ë Œë”ë§ ìë™í™”
â”‚  â”œâ”€ ë‹¨ì : Extension ì½”ë“œ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•„ìš”
â”‚  â””â”€ ì ìš©: Tiptap í¬ìŠ¤íŠ¸ë§Œ
â”‚
â”œâ”€ ë°©ë²• 2: HTML í›„ì²˜ë¦¬ (Cheerio/JSDOM)
â”‚  â”œâ”€ ì¥ì : ëª¨ë“  contentType ì¼ê´€ ì²˜ë¦¬ (Markdown + Tiptap)
â”‚  â”œâ”€ ë‹¨ì : DOM íŒŒì‹± ì˜¤ë²„í—¤ë“œ
â”‚  â””â”€ ì ìš©: ëª¨ë“  í¬ìŠ¤íŠ¸
â”‚
â””â”€ ë°©ë²• 3: í•˜ì´ë¸Œë¦¬ë“œ (ê¶Œì¥ ë°©ë²• 1 + ë°©ë²• 2)
   â”œâ”€ Tiptap: Extension ì‚¬ìš©
   â”œâ”€ Markdown: HTML í›„ì²˜ë¦¬
   â””â”€ ì¼ê´€ëœ ì‚¬ìš©ì ê²½í—˜
```

### âœ… ì„ íƒ: ë°©ë²• 3 (í•˜ì´ë¸Œë¦¬ë“œ)

**ì´ìœ **:
- Tiptapì€ Extensionìœ¼ë¡œ ê¹”ë”í•˜ê²Œ ì²˜ë¦¬
- Markdownì€ í›„ì²˜ë¦¬ë¡œ í˜¸í™˜ì„± ìœ ì§€
- ë‘ ë°©ì‹ ëª¨ë‘ headings ë°°ì—´ê³¼ HTML ID ì¼ì¹˜ ë³´ì¥

---

### êµ¬í˜„: ë°©ë²• 3-1 (Tiptap Extension)

#### 1. Custom Heading Extension

```typescript
// backend/src/posts/utils/tiptap/heading-with-id.extension.ts
import { Heading } from '@tiptap/extension-heading';
import { Node } from '@tiptap/core';

/**
 * Heading ë…¸ë“œì— IDë¥¼ ìë™ ì£¼ì…í•˜ëŠ” Extension
 */
export const HeadingWithId = Heading.extend({
  addAttributes() {
    return {
      ...this.parent?.(),
      id: {
        default: null,
        parseHTML: element => element.getAttribute('id'),
        renderHTML: attributes => {
          // âœ… ID ìë™ ìƒì„± (í…ìŠ¤íŠ¸ ê¸°ë°˜)
          if (!attributes.id && attributes.level) {
            const headingText = this.getTextContent(attributes);
            attributes.id = this.generateId(headingText);
          }

          return {
            id: attributes.id,
          };
        },
      },
    };
  },

  // í…ìŠ¤íŠ¸ ì»¨í…ì¸  ì¶”ì¶œ (Tiptap ë…¸ë“œ ìˆœíšŒ)
  getTextContent(node: any): string {
    if (typeof node === 'string') return node;
    if (node.text) return node.text;
    if (node.content) {
      return node.content.map((child: any) => this.getTextContent(child)).join('');
    }
    return '';
  },

  // ID ìƒì„± (í•œêµ­ì–´/ì˜ì–´ ëª¨ë‘ ì§€ì›)
  generateId(text: string): string {
    return text
      .toLowerCase()
      .replace(/[^a-z0-9ê°€-í£\s-]/g, '')  // íŠ¹ìˆ˜ë¬¸ì ì œê±°
      .replace(/\s+/g, '-')               // ê³µë°± â†’ í•˜ì´í”ˆ
      .replace(/-+/g, '-')                // ì¤‘ë³µ í•˜ì´í”ˆ ì œê±°
      .replace(/^-|-$/g, '');             // ì•ë’¤ í•˜ì´í”ˆ ì œê±°
  },
});
```

#### 2. ì„œë²„ ë Œë”ë§ Extension ë¦¬ìŠ¤íŠ¸ ìˆ˜ì •

```typescript
// backend/src/posts/utils/content-renderer.ts
import StarterKit from '@tiptap/starter-kit';
import { HeadingWithId } from './tiptap/heading-with-id.extension';
// ... ë‚˜ë¨¸ì§€ imports

// âŒ v3.0: StarterKit ê¸°ë³¸ Heading
const viewerExtensions = [
  StarterKit.configure({
    history: false,
  }),
  // ...
];

// âœ… v3.1: Custom Heading Extension
const viewerExtensions = [
  StarterKit.configure({
    history: false,
    heading: false,  // âœ… ê¸°ë³¸ Heading ë¹„í™œì„±í™”
  }),
  HeadingWithId,     // âœ… Custom Heading ì‚¬ìš©
  Image.configure({ /* ... */ }),
  Link.configure({ /* ... */ }),
  Table,
  TableRow,
  TableCell,
  TableHeader,
];

// renderTiptapToHTML() í•¨ìˆ˜ëŠ” ê·¸ëŒ€ë¡œ ì‚¬ìš©
export function renderTiptapToHTML(json: JSONContent): string {
  try {
    // âœ… HeadingWithIdê°€ ìë™ìœ¼ë¡œ ID ì£¼ì…
    const html = generateHTML(json, viewerExtensions);
    return purify.sanitize(html, PURIFY_CONFIG);
  } catch (error) {
    console.error('Tiptap rendering failed:', error);
    return '<p class="text-red-500">ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
  }
}
```

#### 3. Editor Extensionë„ ë™ì¼í•˜ê²Œ ì ìš©

```typescript
// frontend/lib/tiptap/editor-extensions.ts
import StarterKit from '@tiptap/starter-kit'
import { HeadingWithId } from './heading-with-id.extension'  // âœ… í”„ë¡ íŠ¸ì—ë„ ë™ì¼ ë¡œì§

export function getEditorExtensions() {
  return [
    StarterKit.configure({
      heading: false,  // âœ… ê¸°ë³¸ Heading ë¹„í™œì„±í™”
    }),
    HeadingWithId,     // âœ… í¸ì§‘ê¸°ì—ì„œë„ ID ìƒì„±
    Image.configure({ /* ... */ }),
    Link.configure({ /* ... */ }),
    // ...
  ]
}
```

**í”„ë¡ íŠ¸ HeadingWithId êµ¬í˜„** (ë°±ì—”ë“œì™€ ë™ì¼ ë¡œì§):
```typescript
// frontend/lib/tiptap/heading-with-id.extension.ts
import { Heading } from '@tiptap/extension-heading';

export const HeadingWithId = Heading.extend({
  addAttributes() {
    return {
      ...this.parent?.(),
      id: {
        default: null,
        parseHTML: element => element.getAttribute('id'),
        renderHTML: attributes => {
          if (!attributes.id) {
            // âœ… ì—ë””í„°ì—ì„œë„ ìë™ ID ìƒì„± (ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°)
            const text = this.editor.state.doc.textBetween(
              this.editor.state.selection.from,
              this.editor.state.selection.to
            );
            attributes.id = this.generateId(text);
          }

          return { id: attributes.id };
        },
      },
    };
  },

  generateId(text: string): string {
    return text
      .toLowerCase()
      .replace(/[^a-z0-9ê°€-í£\s-]/g, '')
      .replace(/\s+/g, '-')
      .replace(/-+/g, '-')
      .replace(/^-|-$/g, '');
  },
});
```

---

### êµ¬í˜„: ë°©ë²• 3-2 (Markdown HTML í›„ì²˜ë¦¬)

#### Markdown â†’ HTML í›„ì²˜ë¦¬ (ID ì£¼ì…)

```typescript
// backend/src/posts/utils/content-renderer.ts
import { JSDOM } from 'jsdom';

/**
 * Markdownì„ ì•ˆì „í•œ HTMLë¡œ ë³€í™˜ (ID ì£¼ì… í¬í•¨)
 * âœ… v3.1: HTML í›„ì²˜ë¦¬ë¡œ ID ì£¼ì…
 */
export function renderMarkdownToHTML(markdown: string): string {
  try {
    // 1. Markdown â†’ HTML
    const rawHtml = marked.parse(markdown, {
      breaks: true,
      gfm: true,
    }) as string;

    // 2. âœ… v3.1: DOM íŒŒì‹± í›„ Heading ID ì£¼ì…
    const dom = new JSDOM(rawHtml);
    const document = dom.window.document;
    const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');

    headings.forEach((heading) => {
      const text = heading.textContent || '';
      const id = text
        .toLowerCase()
        .replace(/[^a-z0-9ê°€-í£\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-')
        .replace(/^-|-$/g, '');

      heading.setAttribute('id', id);
    });

    // 3. ìˆ˜ì •ëœ HTML ì¶”ì¶œ
    const htmlWithIds = document.body.innerHTML;

    // 4. DOMPurify Sanitize (id ì†ì„± í—ˆìš©)
    return purify.sanitize(htmlWithIds, PURIFY_CONFIG);
  } catch (error) {
    console.error('Markdown rendering failed:', error);
    return '<p class="text-red-500">ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
  }
}
```

---

### í…ŒìŠ¤íŠ¸

#### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

```typescript
// backend/test/utils/content-renderer.spec.ts
import { renderTiptapToHTML, renderMarkdownToHTML } from '../src/posts/utils/content-renderer';

describe('TOC Anchor ID Injection', () => {
  it('[Tiptap] should inject ID into heading', () => {
    const json = {
      type: 'doc',
      content: [
        {
          type: 'heading',
          attrs: { level: 2 },
          content: [{ type: 'text', text: 'ì†Œê°œ' }]
        }
      ]
    };

    const html = renderTiptapToHTML(json);

    // âœ… IDê°€ HTMLì— í¬í•¨ë˜ì–´ì•¼ í•¨
    expect(html).toContain('id="ì†Œê°œ"');
    expect(html).toContain('<h2 id="ì†Œê°œ">ì†Œê°œ</h2>');
  });

  it('[Markdown] should inject ID into heading', () => {
    const markdown = '## ì†Œê°œ\n\në‚´ìš©ì…ë‹ˆë‹¤.';
    const html = renderMarkdownToHTML(markdown);

    // âœ… IDê°€ HTMLì— í¬í•¨ë˜ì–´ì•¼ í•¨
    expect(html).toContain('id="ì†Œê°œ"');
    expect(html).toContain('<h2 id="ì†Œê°œ">ì†Œê°œ</h2>');
  });

  it('should generate same ID for same text', () => {
    const tiptapJson = {
      type: 'doc',
      content: [{
        type: 'heading',
        attrs: { level: 2 },
        content: [{ type: 'text', text: 'Hello World' }]
      }]
    };

    const markdown = '## Hello World';

    const tiptapHtml = renderTiptapToHTML(tiptapJson);
    const markdownHtml = renderMarkdownToHTML(markdown);

    // âœ… ë™ì¼í•œ ID ìƒì„±
    expect(tiptapHtml).toContain('id="hello-world"');
    expect(markdownHtml).toContain('id="hello-world"');
  });
});
```

#### E2E í…ŒìŠ¤íŠ¸

```typescript
// frontend/e2e/toc-navigation.spec.ts
import { test, expect } from '@playwright/test';

test('TOC anchor navigation should work', async ({ page }) => {
  await page.goto('/blog/1');

  // TOC ë§í¬ í´ë¦­
  await page.click('a[href="#ì†Œê°œ"]');

  // âœ… í˜ì´ì§€ ìŠ¤í¬ë¡¤ í™•ì¸
  const headingLocator = page.locator('h2#ì†Œê°œ');
  await expect(headingLocator).toBeInViewport();

  // âœ… URL í•´ì‹œ í™•ì¸
  expect(page.url()).toContain('#ì†Œê°œ');
});
```

---

## ğŸ”§ Issue B: ì¸ì¦ ë°©ì‹ ë¶ˆì¼ì¹˜

### ë¬¸ì œ ë¶„ì„

**í˜„ìƒ**:
```typescript
// âŒ v3.0: ë‘ ê°€ì§€ ë°©ì‹ í˜¼ì¬

// 1. ë¯¸ë“¤ì›¨ì–´: ì¿ í‚¤ ê¸°ë°˜
const token = request.cookies.get('auth-token')?.value

// 2. API í˜¸ì¶œ: Bearer í—¤ë” (localStorage ë˜ëŠ” ì¿ í‚¤)
headers: {
  'Authorization': `Bearer ${token}`
}

// 3. ì¿ í‚¤ë¥¼ HttpOnlyë¡œ ì„¤ì •í•˜ë©´?
document.cookie = 'auth-token=...; HttpOnly'  // âŒ JSì—ì„œ ì„¤ì • ë¶ˆê°€
const token = document.cookie  // âŒ HttpOnly ì¿ í‚¤ëŠ” ì½ì„ ìˆ˜ ì—†ìŒ
```

**ê·¼ë³¸ ì›ì¸**:
- **HttpOnly ì¿ í‚¤**: JS ì ‘ê·¼ ë¶ˆê°€ (XSS ë°©ì–´)
- **Bearer í—¤ë”**: JSì—ì„œ í† í° ì½ì–´ì„œ í—¤ë”ì— ì¶”ê°€ í•„ìš”
- **ë¶ˆê°€ëŠ¥í•œ ì¡°í•©**: `HttpOnly ì¿ í‚¤ + JSì—ì„œ Bearer í—¤ë” ìƒì„±`

### í•´ê²° ë°©ì•ˆ ê²°ì • íŠ¸ë¦¬

```
ì¸ì¦ ë°©ì‹ ì„ íƒ
â”œâ”€ ë°©ë²• 1: Cookie-based Auth (Recommended for SSR) âœ…
â”‚  â”œâ”€ ì¿ í‚¤: HttpOnly, Secure, SameSite=Strict
â”‚  â”œâ”€ ë°±ì—”ë“œ: ì¿ í‚¤ì—ì„œ ì§ì ‘ í† í° ì¶”ì¶œ
â”‚  â”œâ”€ í”„ë¡ íŠ¸: ì¿ í‚¤ ìë™ ì „ì†¡ (credentials: 'include')
â”‚  â”œâ”€ ì¥ì : XSS ë°©ì–´, CSRF í† í°ë§Œ ì¶”ê°€í•˜ë©´ ì™„ë²½
â”‚  â”œâ”€ ë‹¨ì : CORS ì„¤ì • í•„ìš”, ì„œë¸Œë„ë©”ì¸ ê³µìœ  ë³µì¡
â”‚  â””â”€ ì í•©: SSR ì¤‘ì‹¬ ì• í”Œë¦¬ì¼€ì´ì…˜
â”‚
â”œâ”€ ë°©ë²• 2: Bearer Token (localStorage)
â”‚  â”œâ”€ ì €ì¥: localStorage.setItem('token', ...)
â”‚  â”œâ”€ ì „ì†¡: Authorization: Bearer {token}
â”‚  â”œâ”€ ì¥ì : êµ¬í˜„ ê°„ë‹¨, ì„œë¸Œë„ë©”ì¸ ê³µìœ  ì‰¬ì›€
â”‚  â”œâ”€ ë‹¨ì : XSS ì·¨ì•½ (localStorage ì ‘ê·¼ ê°€ëŠ¥)
â”‚  â”œâ”€ ë³´ì™„: ì—„ê²©í•œ CSP í•„ìˆ˜
â”‚  â””â”€ ì í•©: SPA ì¤‘ì‹¬, API ë¶„ë¦¬
â”‚
â””â”€ ë°©ë²• 3: Hybrid (ì¿ í‚¤ ì €ì¥ + Bearer í—¤ë”)
   â”œâ”€ ì¿ í‚¤: Non-HttpOnly (JS ì½ê¸° ê°€ëŠ¥)
   â”œâ”€ ì „ì†¡: Authorization: Bearer {token from cookie}
   â”œâ”€ ì¥ì : ì¿ í‚¤ ë³´ì•ˆ ê¸°ëŠ¥ + Bearer í˜¸í™˜ì„±
   â”œâ”€ ë‹¨ì : HttpOnly ì‚¬ìš© ë¶ˆê°€ (XSS ìœ„í—˜)
   â””â”€ ì í•©: ë ˆê±°ì‹œ í˜¸í™˜ í•„ìš” ì‹œ
```

### âœ… ì„ íƒ: ë°©ë²• 1 (Cookie-based Auth)

**ì´ìœ **:
- Next.js App RouterëŠ” SSR ì¤‘ì‹¬ â†’ ì¿ í‚¤ ìì—°ìŠ¤ëŸ¬ì›€
- HttpOnlyë¡œ XSS ì™„ì „ ì°¨ë‹¨
- `credentials: 'include'`ë¡œ ìë™ ì¿ í‚¤ ì „ì†¡
- NestJS `@Req()` ë°ì½”ë ˆì´í„°ë¡œ ì¿ í‚¤ ì ‘ê·¼ ìš©ì´

**íŠ¸ë ˆì´ë“œì˜¤í”„**:
- CORS ì„¤ì • í•„ìš” (`Access-Control-Allow-Credentials: true`)
- CSRF í† í° ì¶”ê°€ í•„ìš” (í”„ë¡ íŠ¸ â†’ ë°±ì—”ë“œ ìš”ì²­ ì‹œ)

---

### êµ¬í˜„: Cookie-based Auth

#### 1. ë°±ì—”ë“œ: ë¡œê·¸ì¸ ì‹œ ì¿ í‚¤ ì„¤ì •

```typescript
// backend/src/auth/auth.controller.ts
import { Controller, Post, Body, Res, HttpCode } from '@nestjs/common';
import { Response } from 'express';
import { AuthService } from './auth.service';

@Controller('auth')
export class AuthController {
  constructor(private authService: AuthService) {}

  @Post('login')
  @HttpCode(200)
  async login(
    @Body() loginDto: { email: string; password: string },
    @Res({ passthrough: true }) response: Response  // âœ… ì¿ í‚¤ ì„¤ì •ìš©
  ) {
    const { access_token, user } = await this.authService.login(loginDto);

    // âœ… v3.1: HttpOnly ì¿ í‚¤ë¡œ í† í° ì„¤ì •
    response.cookie('auth-token', access_token, {
      httpOnly: true,      // âœ… JS ì ‘ê·¼ ë¶ˆê°€ (XSS ë°©ì–´)
      secure: process.env.NODE_ENV === 'production',  // âœ… HTTPS only
      sameSite: 'strict',  // âœ… CSRF ë°©ì–´
      maxAge: 7 * 24 * 60 * 60 * 1000,  // 7ì¼
      path: '/',
    });

    // âœ… ì‘ë‹µ bodyì—ëŠ” í† í° ì œì™¸ (ì¿ í‚¤ë¡œë§Œ ì „ì†¡)
    return {
      message: 'Login successful',
      user: {
        id: user.id,
        email: user.email,
        role: user.role,
      },
    };
  }

  @Post('logout')
  @HttpCode(200)
  async logout(@Res({ passthrough: true }) response: Response) {
    // âœ… ì¿ í‚¤ ì‚­ì œ
    response.clearCookie('auth-token', {
      httpOnly: true,
      secure: process.env.NODE_ENV === 'production',
      sameSite: 'strict',
      path: '/',
    });

    return { message: 'Logout successful' };
  }
}
```

#### 2. ë°±ì—”ë“œ: JwtStrategy ìˆ˜ì • (ì¿ í‚¤ì—ì„œ í† í° ì¶”ì¶œ)

```typescript
// backend/src/auth/common/jwt.strategy.ts
import { Injectable, UnauthorizedException } from '@nestjs/common';
import { PassportStrategy } from '@nestjs/passport';
import { ExtractJwt, Strategy } from 'passport-jwt';
import { Request } from 'express';

@Injectable()
export class JwtStrategy extends PassportStrategy(Strategy) {
  constructor() {
    super({
      // âŒ v3.0: Authorization í—¤ë”ì—ì„œë§Œ ì¶”ì¶œ
      // jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),

      // âœ… v3.1: ì¿ í‚¤ì—ì„œ ì¶”ì¶œ (ìš°ì„ ìˆœìœ„)
      jwtFromRequest: ExtractJwt.fromExtractors([
        (request: Request) => {
          // 1ìˆœìœ„: ì¿ í‚¤
          const token = request?.cookies?.['auth-token'];
          if (token) return token;

          // 2ìˆœìœ„: Authorization í—¤ë” (API í˜¸í™˜ì„±)
          const authHeader = request?.headers?.authorization;
          if (authHeader?.startsWith('Bearer ')) {
            return authHeader.substring(7);
          }

          return null;
        },
      ]),
      ignoreExpiration: false,
      secretOrKey: process.env.JWT_SECRET,
    });
  }

  async validate(payload: any) {
    return {
      userId: payload.sub,
      email: payload.email,
      role: payload.role,
    };
  }
}
```

#### 3. ë°±ì—”ë“œ: CORS ì„¤ì • (ì¿ í‚¤ í—ˆìš©)

```typescript
// backend/src/main.ts
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import * as cookieParser from 'cookie-parser';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);

  // âœ… v3.1: ì¿ í‚¤ íŒŒì„œ ì¶”ê°€
  app.use(cookieParser());

  // âœ… CORS ì„¤ì • (ì¿ í‚¤ í—ˆìš©)
  app.enableCors({
    origin: process.env.FRONTEND_URL || 'http://localhost:3000',
    credentials: true,  // âœ… ì¿ í‚¤ ì „ì†¡ í—ˆìš©
    methods: ['GET', 'POST', 'PATCH', 'DELETE', 'OPTIONS'],
    allowedHeaders: ['Content-Type', 'Authorization'],
  });

  await app.listen(3002);
}
bootstrap();
```

**ì˜ì¡´ì„± ì¶”ê°€**:
```bash
cd backend
npm install cookie-parser
npm install -D @types/cookie-parser
```

#### 4. í”„ë¡ íŠ¸ì—”ë“œ: API í˜¸ì¶œ ìˆ˜ì • (credentials: 'include')

```typescript
// frontend/lib/api.ts
const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3002';

// âœ… v3.1: ëª¨ë“  ìš”ì²­ì— credentials ì¶”ê°€
export async function createPost(data: any) {
  const response = await fetch(`${API_URL}/posts`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      // âŒ v3.0: Authorization í—¤ë” ì œê±°
      // 'Authorization': `Bearer ${token}`,
    },
    credentials: 'include',  // âœ… ì¿ í‚¤ ìë™ ì „ì†¡
    body: JSON.stringify(data),
  });

  if (!response.ok) {
    throw new Error('Failed to create post');
  }

  return response.json();
}

export async function updatePost(id: string, data: any) {
  const response = await fetch(`${API_URL}/posts/${id}`, {
    method: 'PATCH',
    headers: {
      'Content-Type': 'application/json',
    },
    credentials: 'include',  // âœ… ì¿ í‚¤ ìë™ ì „ì†¡
    body: JSON.stringify(data),
  });

  if (!response.ok) {
    throw new Error('Failed to update post');
  }

  return response.json();
}

// âœ… ëª¨ë“  API í•¨ìˆ˜ì— credentials: 'include' ì¶”ê°€
export async function deletePost(id: string) {
  const response = await fetch(`${API_URL}/posts/${id}`, {
    method: 'DELETE',
    credentials: 'include',
  });

  if (!response.ok) {
    throw new Error('Failed to delete post');
  }

  return response.json();
}
```

#### 5. í”„ë¡ íŠ¸ì—”ë“œ: ë¡œê·¸ì¸ UI ìˆ˜ì •

```typescript
// frontend/app/login/page.tsx
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'

export default function LoginPage() {
  const router = useRouter()
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')

  const handleLogin = async (e: React.FormEvent) => {
    e.preventDefault()

    try {
      const response = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/auth/login`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        credentials: 'include',  // âœ… ì¿ í‚¤ ì €ì¥
        body: JSON.stringify({ email, password }),
      })

      if (!response.ok) {
        throw new Error('Login failed')
      }

      const data = await response.json()

      // âœ… v3.1: localStorage ì‚¬ìš© ì•ˆ í•¨ (ì¿ í‚¤ë¡œë§Œ ê´€ë¦¬)
      // localStorage.setItem('auth-token', data.access_token)  // âŒ ì œê±°

      // âœ… ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸
      router.push('/admin')
    } catch (error) {
      console.error('Login error:', error)
      alert('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')
    }
  }

  return (
    <form onSubmit={handleLogin}>
      {/* ... í¼ UI */}
    </form>
  )
}
```

#### 6. í”„ë¡ íŠ¸ì—”ë“œ: ë¡œê·¸ì•„ì›ƒ

```typescript
// frontend/components/admin/LogoutButton.tsx
'use client'

import { useRouter } from 'next/navigation'

export function LogoutButton() {
  const router = useRouter()

  const handleLogout = async () => {
    try {
      await fetch(`${process.env.NEXT_PUBLIC_API_URL}/auth/logout`, {
        method: 'POST',
        credentials: 'include',  // âœ… ì¿ í‚¤ ì‚­ì œ
      })

      // âœ… v3.1: localStorage ì‚¬ìš© ì•ˆ í•¨
      // localStorage.removeItem('auth-token')  // âŒ ì œê±°

      router.push('/login')
    } catch (error) {
      console.error('Logout error:', error)
    }
  }

  return (
    <button onClick={handleLogout}>
      ë¡œê·¸ì•„ì›ƒ
    </button>
  )
}
```

#### 7. í”„ë¡ íŠ¸ì—”ë“œ: Middleware ìˆ˜ì •

```typescript
// frontend/middleware.ts
import { NextResponse } from 'next/server'
import type { NextRequest } from 'next/server'

export function middleware(request: NextRequest) {
  const { pathname } = request.nextUrl

  // âœ… v3.1: ì¿ í‚¤ì—ì„œ í† í° í™•ì¸ (ê·¸ëŒ€ë¡œ ìœ ì§€)
  if (pathname.startsWith('/admin')) {
    const token = request.cookies.get('auth-token')?.value

    if (!token) {
      return NextResponse.redirect(new URL('/login', request.url))
    }

    // âœ… JWT ê²€ì¦ (ì„ íƒì  - ì„±ëŠ¥ìƒ ë°±ì—”ë“œì— ìœ„ì„ ê¶Œì¥)
    // ê°„ë‹¨íˆ ì¡´ì¬ ì—¬ë¶€ë§Œ í™•ì¸í•˜ê±°ë‚˜, ë°±ì—”ë“œ APIë¡œ ê²€ì¦
  }

  return NextResponse.next()
}

export const config = {
  matcher: '/admin/:path*',
}
```

---

### CSRF ë³´í˜¸ ì¶”ê°€ (ì„ íƒì )

#### Backend: CSRF í† í° ìƒì„±

```typescript
// backend/src/auth/auth.controller.ts
import { randomBytes } from 'crypto';

@Get('csrf-token')
async getCsrfToken(@Res({ passthrough: true }) response: Response) {
  const csrfToken = randomBytes(32).toString('hex');

  // âœ… CSRF í† í°ë„ ì¿ í‚¤ë¡œ ì„¤ì •
  response.cookie('csrf-token', csrfToken, {
    httpOnly: false,  // âœ… JSì—ì„œ ì½ì–´ì•¼ í•¨
    secure: process.env.NODE_ENV === 'production',
    sameSite: 'strict',
    maxAge: 60 * 60 * 1000,  // 1ì‹œê°„
  });

  return { csrfToken };
}
```

#### Backend: CSRF ê²€ì¦ Guard

```typescript
// backend/src/common/guards/csrf.guard.ts
import { Injectable, CanActivate, ExecutionContext, ForbiddenException } from '@nestjs/common';

@Injectable()
export class CsrfGuard implements CanActivate {
  canActivate(context: ExecutionContext): boolean {
    const request = context.switchToHttp().getRequest();
    const csrfTokenFromCookie = request.cookies['csrf-token'];
    const csrfTokenFromHeader = request.headers['x-csrf-token'];

    if (!csrfTokenFromCookie || !csrfTokenFromHeader) {
      throw new ForbiddenException('CSRF token missing');
    }

    if (csrfTokenFromCookie !== csrfTokenFromHeader) {
      throw new ForbiddenException('CSRF token mismatch');
    }

    return true;
  }
}
```

#### Frontend: CSRF í—¤ë” ì¶”ê°€

```typescript
// frontend/lib/api.ts
async function getCsrfToken(): Promise<string> {
  const response = await fetch(`${API_URL}/auth/csrf-token`, {
    credentials: 'include',
  });

  const data = await response.json();
  return data.csrfToken;
}

export async function createPost(data: any) {
  const csrfToken = await getCsrfToken();

  const response = await fetch(`${API_URL}/posts`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRF-Token': csrfToken,  // âœ… CSRF í† í° í—¤ë”
    },
    credentials: 'include',
    body: JSON.stringify(data),
  });

  // ...
}
```

---

## ğŸ”§ Issue C: Edge Runtime crypto ì˜¤ë¥˜

### ë¬¸ì œ ë¶„ì„

**í˜„ìƒ**:
```typescript
// âŒ v3.0: middleware.ts
import { randomBytes } from 'crypto';  // Node.js API

export function middleware(request: NextRequest) {
  const nonce = randomBytes(16).toString('base64');  // âŒ Edge Runtime ì—ëŸ¬
  // ...
}
```

**ì—ëŸ¬ ë©”ì‹œì§€**:
```
Error: Module "crypto" is not available in Edge Runtime
```

**ê·¼ë³¸ ì›ì¸**:
- Next.js MiddlewareëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **Edge Runtime** ì‚¬ìš©
- Edge Runtimeì€ Node.js API (`crypto`, `fs` ë“±) ë¯¸ì§€ì›
- Web Standard APIë§Œ ì‚¬ìš© ê°€ëŠ¥

### í•´ê²° ë°©ì•ˆ ê²°ì • íŠ¸ë¦¬

```
Edge Runtime í˜¸í™˜ ë‚œìˆ˜ ìƒì„±
â”œâ”€ ë°©ë²• 1: Web Crypto API (crypto.randomUUID()) âœ… ê¶Œì¥
â”‚  â”œâ”€ API: crypto.randomUUID() ë˜ëŠ” crypto.getRandomValues()
â”‚  â”œâ”€ í˜¸í™˜: Edge Runtime ì™„ë²½ ì§€ì›
â”‚  â”œâ”€ ì¥ì : í‘œì¤€ API, ë³„ë„ ì„¤ì • ë¶ˆí•„ìš”
â”‚  â””â”€ ë‹¨ì : base64 ë³€í™˜ ìˆ˜ë™ êµ¬í˜„ í•„ìš”
â”‚
â”œâ”€ ë°©ë²• 2: Node.js Runtime ê°•ì œ ì‚¬ìš©
â”‚  â”œâ”€ ì„¤ì •: export const runtime = 'nodejs'
â”‚  â”œâ”€ ì¥ì : ê¸°ì¡´ ì½”ë“œ ê·¸ëŒ€ë¡œ ì‚¬ìš©
â”‚  â”œâ”€ ë‹¨ì : Edgeì˜ ë¹ ë¥¸ ì½œë“œ ìŠ¤íƒ€íŠ¸ ìƒì‹¤
â”‚  â””â”€ ì í•©: Edge ê¸°ëŠ¥ ë¶ˆí•„ìš” ì‹œ
â”‚
â””â”€ ë°©ë²• 3: ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ (uuid)
   â”œâ”€ íŒ¨í‚¤ì§€: npm install uuid
   â”œâ”€ API: uuidv4()
   â”œâ”€ ì¥ì : ê°„í¸í•œ UUID ìƒì„±
   â””â”€ ë‹¨ì : ì¶”ê°€ ì˜ì¡´ì„±
```

### âœ… ì„ íƒ: ë°©ë²• 1 (Web Crypto API)

**ì´ìœ **:
- Edge Runtimeì˜ ë¹ ë¥¸ ì‘ë‹µì†ë„ ìœ ì§€
- í‘œì¤€ Web API (ë¸Œë¼ìš°ì €/Edge ê³µí†µ)
- ì˜ì¡´ì„± ì œë¡œ

---

### êµ¬í˜„: Web Crypto API

#### 1. Middleware ìˆ˜ì •

```typescript
// frontend/middleware.ts
import { NextResponse } from 'next/server'
import type { NextRequest } from 'next/server'

/**
 * âœ… v3.1: Web Crypto APIë¡œ nonce ìƒì„± (Edge Runtime í˜¸í™˜)
 */
function generateNonce(): string {
  // Web Crypto API ì‚¬ìš© (Edge Runtime ì§€ì›)
  return crypto.randomUUID();

  // ë˜ëŠ” base64 í˜•ì‹ì´ í•„ìš”í•œ ê²½ìš°:
  // const array = new Uint8Array(16);
  // crypto.getRandomValues(array);
  // return btoa(String.fromCharCode(...array));
}

export function middleware(request: NextRequest) {
  const { pathname } = request.nextUrl

  // âœ… Edge Runtime í˜¸í™˜ ë‚œìˆ˜ ìƒì„±
  const nonce = generateNonce();

  // ê´€ë¦¬ì ê²½ë¡œ ì²´í¬
  if (pathname.startsWith('/admin')) {
    const token = request.cookies.get('auth-token')?.value

    if (!token) {
      return NextResponse.redirect(new URL('/login', request.url))
    }
  }

  // CSP í—¤ë” ì¶”ê°€
  const response = NextResponse.next()

  const cspHeader = `
    default-src 'self';
    script-src 'self' 'nonce-${nonce}';
    style-src 'self' 'nonce-${nonce}';
    img-src 'self' data: https:;
    font-src 'self' data:;
    connect-src 'self' ${process.env.NEXT_PUBLIC_API_URL};
    frame-ancestors 'none';
    base-uri 'self';
    form-action 'self';
  `.replace(/\s{2,}/g, ' ').trim()

  response.headers.set('Content-Security-Policy', cspHeader)
  response.headers.set('X-Frame-Options', 'DENY')
  response.headers.set('X-Content-Type-Options', 'nosniff')
  response.headers.set('X-Nonce', nonce)  // âœ… í”„ë¡ íŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡

  return response
}

export const config = {
  matcher: '/:path*',
}
```

#### 2. Base64 í˜•ì‹ Nonce (CSP í‘œì¤€)

CSP `nonce-` ê°’ì€ ì¼ë°˜ì ìœ¼ë¡œ base64 í˜•ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:

```typescript
// middleware.ts
function generateNonce(): string {
  // âœ… 16ë°”ì´íŠ¸ ëœë¤ ê°’ ìƒì„±
  const array = new Uint8Array(16);
  crypto.getRandomValues(array);

  // âœ… base64 ì¸ì½”ë”©
  return btoa(String.fromCharCode(...array));
}
```

---

## ğŸ”§ Issue D: CSP nonce ë¯¸ì ìš©

### ë¬¸ì œ ë¶„ì„

**í˜„ìƒ**:
```typescript
// âŒ v3.0: CSP í—¤ë”ë§Œ ì„¤ì •
Content-Security-Policy: script-src 'self' 'nonce-abc123'

// âŒ ì‹¤ì œ HTMLì—ëŠ” nonce ì—†ìŒ
<script src="/app.js"></script>  // âŒ Blocked by CSP

// âœ… í•„ìš”í•œ í˜•íƒœ
<script src="/app.js" nonce="abc123"></script>
```

**ê·¼ë³¸ ì›ì¸**:
- CSP í—¤ë”ì— `nonce-{value}` ì„¤ì •í–ˆì§€ë§Œ
- ì‹¤ì œ `<script>`, `<style>` íƒœê·¸ì— `nonce` ì†ì„± ì—†ìŒ
- Next.jsëŠ” ìë™ìœ¼ë¡œ nonceë¥¼ ì£¼ì…í•˜ì§€ ì•ŠìŒ (Next.js 15 ê¸°ì¤€)

### í•´ê²° ë°©ì•ˆ ê²°ì • íŠ¸ë¦¬

```
CSP Nonce ì ìš© ë°©ë²•
â”œâ”€ ë°©ë²• 1: Next.js App Router ìë™ ì£¼ì… (ì‹¤í—˜ì ) âš ï¸
â”‚  â”œâ”€ ì„¤ì •: next.config.jsì—ì„œ í™œì„±í™”
â”‚  â”œâ”€ ì¥ì : ìë™í™”
â”‚  â”œâ”€ ë‹¨ì : Next.js 15ì—ì„œ ë¶ˆì•ˆì •, ë¬¸ì„œí™” ë¯¸í¡
â”‚  â””â”€ ìƒíƒœ: Experimental
â”‚
â”œâ”€ ë°©ë²• 2: React Context + useEffect ìˆ˜ë™ ì£¼ì… âœ… ê¶Œì¥
â”‚  â”œâ”€ 1. Middlewareê°€ X-Nonce í—¤ë” ì„¤ì •
â”‚  â”œâ”€ 2. Layoutì—ì„œ Contextë¡œ nonce ì „íŒŒ
â”‚  â”œâ”€ 3. Script ì»´í¬ë„ŒíŠ¸ì— nonce prop ì „ë‹¬
â”‚  â”œâ”€ ì¥ì : ì•ˆì •ì , ì œì–´ ê°€ëŠ¥
â”‚  â””â”€ ë‹¨ì : ì½”ë“œ ì¶”ê°€ í•„ìš”
â”‚
â””â”€ ë°©ë²• 3: CSP ì™„í™” (ë¹„ê¶Œì¥)
   â”œâ”€ script-src 'self' 'unsafe-inline'
   â”œâ”€ ì¥ì : êµ¬í˜„ ë¶ˆí•„ìš”
   â””â”€ ë‹¨ì : XSS ë°©ì–´ ì•½í™” (âš ï¸ ë³´ì•ˆ ìœ„í—˜)
```

### âœ… ì„ íƒ: ë°©ë²• 2 (React Context + ìˆ˜ë™ ì£¼ì…)

**ì´ìœ **:
- Next.js 15ì˜ ìë™ ì£¼ì… ê¸°ëŠ¥ì€ ì•„ì§ ë¶ˆì•ˆì •
- Context APIë¡œ ì™„ì „í•œ ì œì–´ ê°€ëŠ¥
- í”„ë¡œë•ì…˜ ì•ˆì •ì„± í™•ë³´

---

### êµ¬í˜„: React Context + ìˆ˜ë™ ì£¼ì…

#### 1. Nonce Context ìƒì„±

```typescript
// frontend/app/nonce-context.tsx
'use client'

import { createContext, useContext } from 'react'

const NonceContext = createContext<string | null>(null)

export function NonceProvider({
  children,
  nonce,
}: {
  children: React.ReactNode
  nonce: string
}) {
  return <NonceContext.Provider value={nonce}>{children}</NonceContext.Provider>
}

export function useNonce() {
  return useContext(NonceContext)
}
```

#### 2. RootLayoutì—ì„œ Nonce ì „íŒŒ

```typescript
// frontend/app/layout.tsx
import { headers } from 'next/headers'
import { NonceProvider } from './nonce-context'

export default async function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  // âœ… Middlewareê°€ ì„¤ì •í•œ X-Nonce í—¤ë” ì½ê¸°
  const headersList = await headers()
  const nonce = headersList.get('X-Nonce') || ''

  return (
    <html lang="ko">
      <head>
        {/* âœ… nonce ì ìš©ëœ ìŠ¤íƒ€ì¼ì‹œíŠ¸ */}
        <link rel="stylesheet" href="/globals.css" nonce={nonce} />
      </head>
      <body>
        <NonceProvider nonce={nonce}>
          {children}
        </NonceProvider>
      </body>
    </html>
  )
}
```

#### 3. Script ì»´í¬ë„ŒíŠ¸ì— Nonce ì „ë‹¬

```typescript
// frontend/app/admin/posts/new/page.tsx (ì˜ˆì‹œ)
'use client'

import Script from 'next/script'
import { useNonce } from '@/app/nonce-context'

export default function NewPostPage() {
  const nonce = useNonce()

  return (
    <div>
      {/* âœ… nonce ì ìš©ëœ ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸ */}
      <Script
        src="https://cdn.jsdelivr.net/npm/@tiptap/core"
        strategy="beforeInteractive"
        nonce={nonce || undefined}
      />

      {/* í˜ì´ì§€ ë‚´ìš© */}
    </div>
  )
}
```

#### 4. Inline Scriptì— Nonce ì ìš©

```typescript
// frontend/app/layout.tsx
export default async function RootLayout({ children }: { children: React.ReactNode }) {
  const headersList = await headers()
  const nonce = headersList.get('X-Nonce') || ''

  return (
    <html lang="ko">
      <head>
        {/* âœ… Inline scriptì— nonce ì ìš© */}
        <script
          nonce={nonce}
          dangerouslySetInnerHTML={{
            __html: `
              // Google Analytics ë“± inline script
              (function() {
                console.log('Nonce applied!');
              })();
            `,
          }}
        />
      </head>
      <body>
        <NonceProvider nonce={nonce}>{children}</NonceProvider>
      </body>
    </html>
  )
}
```

#### 5. Tailwind CSS (Inline Styles) Nonce ì ìš©

**ë¬¸ì œ**: Tailwind CSSëŠ” ë¹Œë“œ íƒ€ì„ì— CSS ìƒì„± â†’ Nonce ë¶ˆê°€ëŠ¥

**í•´ê²°**:
```typescript
// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  // âœ… ì™¸ë¶€ CSS íŒŒì¼ ì‚¬ìš© (nonce ì ìš© ê°€ëŠ¥)
  // Inline styles ìµœì†Œí™”
  compiler: {
    // Tailwind JIT ì‚¬ìš© ì‹œ ì™¸ë¶€ íŒŒì¼ë¡œ ì¶”ì¶œ
  },
}

module.exports = nextConfig
```

**ë˜ëŠ” CSP ì™„í™”** (Tailwind CSSë§Œ):
```typescript
// middleware.ts
const cspHeader = `
  default-src 'self';
  script-src 'self' 'nonce-${nonce}';
  style-src 'self' 'nonce-${nonce}' 'unsafe-inline';  // âœ… Tailwindë§Œ í—ˆìš©
  img-src 'self' data: https:;
  ...
`.replace(/\s{2,}/g, ' ').trim()
```

**ê¶Œì¥**: `style-src 'unsafe-inline'` ì¶”ê°€ (Tailwind CSSëŠ” XSS ìœ„í—˜ ë‚®ìŒ)

---

## ğŸ”§ Issue E: í•œêµ­ì–´ ê²€ìƒ‰ ì‹¤íŒ¨

### ë¬¸ì œ ë¶„ì„

**í˜„ìƒ**:
```sql
-- âŒ v3.0: ì˜ì–´ Full-text ì„¤ì •
CREATE INDEX idx_posts_plain_text_fulltext
ON posts USING gin(to_tsvector('english', plain_text));

-- âŒ í•œêµ­ì–´ ê²€ìƒ‰ ì‹¤íŒ¨
SELECT * FROM posts
WHERE to_tsvector('english', plain_text) @@ to_tsquery('english', 'ë¦¬ì•¡íŠ¸');
-- ê²°ê³¼: 0 rows (ì˜ì–´ í˜•íƒœì†Œ ë¶„ì„ê¸°ê°€ í•œêµ­ì–´ ì²˜ë¦¬ ë¶ˆê°€)
```

**ê·¼ë³¸ ì›ì¸**:
- `to_tsvector('english', ...)`: ì˜ì–´ í˜•íƒœì†Œ ë¶„ì„ (stemming)
- í•œêµ­ì–´ëŠ” í˜•íƒœì†Œ êµ¬ì¡°ê°€ ë‹¤ë¦„ â†’ ì¸ë±ìŠ¤ ìƒì„± ì‹¤íŒ¨
- PostgreSQL ê¸°ë³¸ ì œê³µ: `english`, `simple` (í•œêµ­ì–´ ë¯¸ì§€ì›)

### í•´ê²° ë°©ì•ˆ ê²°ì • íŠ¸ë¦¬

```
í•œêµ­ì–´ ê²€ìƒ‰ ì¸ë±ìŠ¤ ì„ íƒ
â”œâ”€ ë°©ë²• 1: to_tsvector('simple', ...) âœ… ê¶Œì¥ (ê¸°ë³¸)
â”‚  â”œâ”€ ì„¤ëª…: í˜•íƒœì†Œ ë¶„ì„ ì—†ì´ ë‹¨ìˆœ í† í°í™”
â”‚  â”œâ”€ ì¥ì : PostgreSQL ê¸°ë³¸ ì œê³µ, ì„¤ì • ë¶ˆí•„ìš”
â”‚  â”œâ”€ ë‹¨ì : ì •í™•ë„ ë‚®ìŒ (ì–´ê°„ ì¶”ì¶œ ì—†ìŒ)
â”‚  â””â”€ ì í•©: ì¤‘ì†Œ ê·œëª¨, ë¹ ë¥¸ êµ¬í˜„
â”‚
â”œâ”€ ë°©ë²• 2: pg_trgm (Trigram Index) âœ… ê¶Œì¥ (ê³ í’ˆì§ˆ)
â”‚  â”œâ”€ Extension: CREATE EXTENSION pg_trgm
â”‚  â”œâ”€ ì¸ë±ìŠ¤: GIN index on (plain_text gin_trgm_ops)
â”‚  â”œâ”€ ê²€ìƒ‰: WHERE plain_text ILIKE '%ê²€ìƒ‰ì–´%'
â”‚  â”œâ”€ ì¥ì : í•œêµ­ì–´ ì™„ë²½ ì§€ì›, ì˜¤íƒ€ í—ˆìš©
â”‚  â”œâ”€ ë‹¨ì : ì¸ë±ìŠ¤ í¬ê¸° ì¦ê°€
â”‚  â””â”€ ì í•©: í”„ë¡œë•ì…˜ í’ˆì§ˆ
â”‚
â”œâ”€ ë°©ë°© 3: í•œêµ­ì–´ í˜•íƒœì†Œ ë¶„ì„ê¸° (pg_Korean ë“±)
â”‚  â”œâ”€ Extension: ì™¸ë¶€ íŒ¨í‚¤ì§€ ì„¤ì¹˜ í•„ìš”
â”‚  â”œâ”€ ì¥ì : í˜•íƒœì†Œ ë¶„ì„ (ë†’ì€ ì •í™•ë„)
â”‚  â”œâ”€ ë‹¨ì : ì„¤ì¹˜ ë³µì¡, ê´€ë¦¬ ë¹„ìš©
â”‚  â””â”€ ì í•©: ëŒ€ê·œëª¨ ê²€ìƒ‰ ì—”ì§„
â”‚
â””â”€ ë°©ë²• 4: ì™¸ë¶€ ê²€ìƒ‰ ì„œë¹„ìŠ¤ (Elasticsearch, Meilisearch)
   â”œâ”€ ì¥ì : ê³ ê¸‰ ê²€ìƒ‰ ê¸°ëŠ¥ (í˜•íƒœì†Œ, ë™ì˜ì–´, ë­í‚¹)
   â”œâ”€ ë‹¨ì : ì¸í”„ë¼ ë¹„ìš©, ë³µì¡ë„ ì¦ê°€
   â””â”€ ì í•©: ê²€ìƒ‰ì´ í•µì‹¬ ê¸°ëŠ¥ì¸ ì„œë¹„ìŠ¤
```

### âœ… ì„ íƒ: ë°©ë²• 2 (pg_trgm)

**ì´ìœ **:
- PostgreSQL ê³µì‹ Extension (ì•ˆì •ì )
- í•œêµ­ì–´/ì˜ì–´/ì¼ë³¸ì–´ ëª¨ë‘ ì§€ì›
- ë¶€ë¶„ ì¼ì¹˜, ì˜¤íƒ€ í—ˆìš©
- ì¸ë±ìŠ¤ í¬ê¸° í•©ë¦¬ì  (~2-3ë°°)

**ëŒ€ì•ˆ**: ì´ˆê¸°ì—ëŠ” ë°©ë²• 1 (simple) ì‚¬ìš© â†’ íŠ¸ë˜í”½ ì¦ê°€ ì‹œ ë°©ë²• 2ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜

---

### êµ¬í˜„: pg_trgm (Trigram Index)

#### 1. PostgreSQL Extension í™œì„±í™”

```sql
-- PostgreSQLì—ì„œ ì‹¤í–‰
CREATE EXTENSION IF NOT EXISTS pg_trgm;
```

#### 2. Migration ìˆ˜ì •

```typescript
// backend/migrations/YYYYMMDDHHMMSS-add-tiptap-fields.ts
import { MigrationInterface, QueryRunner, TableColumn } from 'typeorm';

export class AddTiptapFields1234567890123 implements MigrationInterface {
  public async up(queryRunner: QueryRunner): Promise<void> {
    // ... ê¸°ì¡´ ì»¬ëŸ¼ ì¶”ê°€ ì½”ë“œ

    // âŒ v3.0: ì˜ì–´ Full-text ì¸ë±ìŠ¤
    // await queryRunner.query(`
    //   CREATE INDEX idx_posts_plain_text_fulltext
    //   ON posts USING gin(to_tsvector('english', plain_text))
    // `);

    // âœ… v3.1: pg_trgm ì¸ë±ìŠ¤ (í•œêµ­ì–´ ì§€ì›)
    await queryRunner.query(`
      CREATE EXTENSION IF NOT EXISTS pg_trgm;
    `);

    await queryRunner.query(`
      CREATE INDEX idx_posts_plain_text_trgm
      ON posts USING gin(plain_text gin_trgm_ops);
    `);

    // âœ… contentType ì¸ë±ìŠ¤
    await queryRunner.query(`
      CREATE INDEX idx_posts_content_type ON posts(content_type)
    `);
  }

  public async down(queryRunner: QueryRunner): Promise<void> {
    // ... ê¸°ì¡´ ë¡¤ë°± ì½”ë“œ
    await queryRunner.query('DROP INDEX idx_posts_plain_text_trgm');
    await queryRunner.query('DROP INDEX idx_posts_content_type');
  }
}
```

#### 3. PostsService ê²€ìƒ‰ ì¿¼ë¦¬ ìˆ˜ì •

```typescript
// backend/src/posts/service/posts.service.ts
import { Injectable } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository, ILike } from 'typeorm';
import { Post } from '../entity/post.entity';

@Injectable()
export class PostsService {
  constructor(
    @InjectRepository(Post)
    private readonly postRepository: Repository<Post>,
  ) {}

  /**
   * âœ… v3.1: pg_trgm ê¸°ë°˜ ê²€ìƒ‰ (í•œêµ­ì–´ ì§€ì›)
   */
  async getPosts(
    keyword: string = '',
    tag: string = '',
    page: number = 1,
    pageSize: number = 10
  ): Promise<Post[]> {
    const queryBuilder = this.postRepository
      .createQueryBuilder('post')
      .leftJoinAndSelect('post.tags', 'tag')
      .where('post.status = :status', { status: 'published' });

    // âœ… v3.1: pg_trgm ê²€ìƒ‰ (ILIKE ì‚¬ìš©)
    if (keyword) {
      // âŒ v3.0: Full-text ê²€ìƒ‰ (ì˜ì–´ë§Œ)
      // queryBuilder.andWhere(
      //   `to_tsvector('english', post.plainText) @@ plainto_tsquery('english', :keyword)`,
      //   { keyword }
      // );

      // âœ… v3.1: pg_trgm ê²€ìƒ‰ (ëª¨ë“  ì–¸ì–´)
      queryBuilder.andWhere(
        '(post.title ILIKE :keyword OR post.plainText ILIKE :keyword)',
        { keyword: `%${keyword}%` }
      );

      // âœ… ìœ ì‚¬ë„ ì •ë ¬ (ì„ íƒì  - ë” ë‚˜ì€ ë­í‚¹)
      queryBuilder
        .addSelect(
          `similarity(post.title, :keyword) + similarity(post.plainText, :keyword)`,
          'relevance'
        )
        .orderBy('relevance', 'DESC');
    }

    // íƒœê·¸ í•„í„°
    if (tag) {
      queryBuilder.andWhere('tag.name = :tag', { tag });
    }

    // í˜ì´ì§€ë„¤ì´ì…˜
    queryBuilder
      .skip((page - 1) * pageSize)
      .take(pageSize);

    return queryBuilder.getMany();
  }

  /**
   * ê²€ìƒ‰ ê²°ê³¼ ì¹´ìš´íŠ¸
   */
  async getPostsCount(keyword: string = '', tag: string = ''): Promise<number> {
    const queryBuilder = this.postRepository
      .createQueryBuilder('post')
      .where('post.status = :status', { status: 'published' });

    if (keyword) {
      queryBuilder.andWhere(
        '(post.title ILIKE :keyword OR post.plainText ILIKE :keyword)',
        { keyword: `%${keyword}%` }
      );
    }

    if (tag) {
      queryBuilder
        .leftJoin('post.tags', 'tag')
        .andWhere('tag.name = :tag', { tag });
    }

    return queryBuilder.getCount();
  }
}
```

#### 4. ì„±ëŠ¥ ìµœì í™”: ìµœì†Œ ê²€ìƒ‰ì–´ ê¸¸ì´

```typescript
// backend/src/posts/service/posts.service.ts
async getPosts(
  keyword: string = '',
  tag: string = '',
  page: number = 1,
  pageSize: number = 10
): Promise<Post[]> {
  const queryBuilder = this.postRepository
    .createQueryBuilder('post')
    .leftJoinAndSelect('post.tags', 'tag')
    .where('post.status = :status', { status: 'published' });

  // âœ… ìµœì†Œ 2ê¸€ì ì´ìƒë§Œ ê²€ìƒ‰ (ì„±ëŠ¥ ìµœì í™”)
  if (keyword && keyword.trim().length >= 2) {
    queryBuilder.andWhere(
      '(post.title ILIKE :keyword OR post.plainText ILIKE :keyword)',
      { keyword: `%${keyword}%` }
    );

    // ìœ ì‚¬ë„ ì •ë ¬
    queryBuilder
      .addSelect(
        `similarity(post.title, :keyword) + similarity(post.plainText, :keyword)`,
        'relevance'
      )
      .orderBy('relevance', 'DESC');
  } else if (!keyword) {
    // í‚¤ì›Œë“œ ì—†ìœ¼ë©´ ìµœì‹ ìˆœ ì •ë ¬
    queryBuilder.orderBy('post.publishDate', 'DESC');
  }

  // íƒœê·¸ í•„í„°
  if (tag) {
    queryBuilder.andWhere('tag.name = :tag', { tag });
  }

  queryBuilder
    .skip((page - 1) * pageSize)
    .take(pageSize);

  return queryBuilder.getMany();
}
```

---

### í…ŒìŠ¤íŠ¸

#### í•œêµ­ì–´ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸

```typescript
// backend/test/posts/posts.service.spec.ts
import { Test, TestingModule } from '@nestjs/testing';
import { PostsService } from '../src/posts/service/posts.service';
import { getRepositoryToken } from '@nestjs/typeorm';
import { Post } from '../src/posts/entity/post.entity';

describe('PostsService - Korean Search', () => {
  let service: PostsService;

  beforeEach(async () => {
    // ... ëª¨ë“ˆ ì„¤ì •
  });

  it('should find posts with Korean keyword', async () => {
    const keyword = 'ë¦¬ì•¡íŠ¸';
    const posts = await service.getPosts(keyword);

    // âœ… í•œêµ­ì–´ ê²€ìƒ‰ ê²°ê³¼ í™•ì¸
    expect(posts.length).toBeGreaterThan(0);
    expect(posts[0].title).toContain('ë¦¬ì•¡íŠ¸');
  });

  it('should find posts with partial Korean keyword', async () => {
    const keyword = 'ë¦¬ì•¡';  // ë¶€ë¶„ ì¼ì¹˜
    const posts = await service.getPosts(keyword);

    // âœ… pg_trgmì€ ë¶€ë¶„ ì¼ì¹˜ ì§€ì›
    expect(posts.length).toBeGreaterThan(0);
  });

  it('should handle typo in Korean keyword', async () => {
    const keyword = 'ë¦¬ì—‘íŠ¸';  // ì˜¤íƒ€ (ë¦¬ì•¡íŠ¸ â†’ ë¦¬ì—‘íŠ¸)
    const posts = await service.getPosts(keyword);

    // âœ… similarity í•¨ìˆ˜ë¡œ ìœ ì‚¬ë„ ê¸°ë°˜ ê²€ìƒ‰
    // (ì™„ë²½í•œ ì˜¤íƒ€ í—ˆìš©ì€ ì•„ë‹ˆì§€ë§Œ, ë¶€ë¶„ ì¼ì¹˜ë¡œ ì¼ë¶€ ì»¤ë²„)
    expect(posts).toBeDefined();
  });

  it('should ignore search with less than 2 characters', async () => {
    const keyword = 'ë¦¬';  // 1ê¸€ì
    const posts = await service.getPosts(keyword);

    // âœ… ìµœì†Œ ê¸¸ì´ ê²€ì¦
    expect(posts).toBeDefined();
  });
});
```

---

## ğŸ“ Medium Priority Issues (ê¶Œì¥ ìˆ˜ì •)

### Issue F: DOMPurify í”„ë¡œí† ì½œ ì œí•œ

**ë¬¸ì œ**: ëª¨ë“  í”„ë¡œí† ì½œ í—ˆìš© â†’ XSS ìœ„í—˜ (`javascript:`, `data:` URI)

**í•´ê²°**:
```typescript
// backend/src/posts/utils/content-renderer.ts
const PURIFY_CONFIG = {
  ALLOWED_TAGS: [ /* ... */ ],
  ALLOWED_ATTR: [ /* ... */ ],
  ALLOW_DATA_ATTR: false,

  // âœ… v3.1: ì•ˆì „í•œ í”„ë¡œí† ì½œë§Œ í—ˆìš©
  ALLOWED_URI_REGEXP: /^(?:(?:https?|mailto):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,
  // https://, http://, mailto:, ë˜ëŠ” ìƒëŒ€ê²½ë¡œë§Œ í—ˆìš©
  // javascript:, data: ì°¨ë‹¨
};
```

---

### Issue G: Marked ë Œë”ë§ í’ˆì§ˆ

**ë¬¸ì œ**: ì½”ë“œ ë¸”ë¡, í…Œì´ë¸” ë Œë”ë§ í’ˆì§ˆ ì €í•˜

**í•´ê²°**:
```typescript
// backend/src/posts/utils/content-renderer.ts
import { marked } from 'marked';
import { markedHighlight } from 'marked-highlight';
import hljs from 'highlight.js';

// âœ… v3.1: Syntax Highlighting ì¶”ê°€
marked.use(markedHighlight({
  langPrefix: 'hljs language-',
  highlight(code, lang) {
    const language = hljs.getLanguage(lang) ? lang : 'plaintext';
    return hljs.highlight(code, { language }).value;
  }
}));

// âœ… GFM í…Œì´ë¸” í™œì„±í™”
export function renderMarkdownToHTML(markdown: string): string {
  try {
    const rawHtml = marked.parse(markdown, {
      breaks: true,
      gfm: true,        // âœ… GitHub Flavored Markdown
      tables: true,     // âœ… í…Œì´ë¸” ì§€ì›
      smartLists: true, // âœ… ìŠ¤ë§ˆíŠ¸ ë¦¬ìŠ¤íŠ¸
    }) as string;

    // ... DOM íŒŒì‹±, ID ì£¼ì…, Sanitize
  } catch (error) {
    console.error('Markdown rendering failed:', error);
    return '<p class="text-red-500">ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
  }
}
```

**ì˜ì¡´ì„± ì¶”ê°€**:
```bash
cd backend
npm install marked-highlight highlight.js
```

---

### Issue H: contentJson íƒ€ì… ì•ˆì „ì„±

**ë¬¸ì œ**: `contentJson: any` â†’ ìŠ¤í‚¤ë§ˆ ê²€ì¦ ì—†ìŒ

**í•´ê²°**:
```typescript
// backend/src/posts/entity/post.entity.ts
import { Entity, Column } from 'typeorm';
import { JSONContent } from '@tiptap/core';

@Entity()
export class Post extends BaseEntity {
  // âœ… v3.1: JSONContent íƒ€ì… ì ìš©
  @Column('jsonb', { nullable: true })
  contentJson: JSONContent | null;

  // ...
}
```

**ëŸ°íƒ€ì„ ê²€ì¦ (class-validator)**:
```typescript
// backend/src/posts/dto/request/create-post-request.dto.ts
import { IsObject, ValidateNested } from 'class-validator';
import { Type } from 'class-transformer';

class TiptapContentDTO {
  @IsString()
  type: string;

  @IsArray()
  @ValidateNested({ each: true })
  @Type(() => TiptapContentDTO)
  content?: TiptapContentDTO[];

  @IsObject()
  attrs?: Record<string, any>;

  @IsString()
  text?: string;
}

export class CreatePostRequestDTO {
  @IsString()
  title: string;

  @ValidateIf(o => o.contentType === 'tiptap-json')
  @IsObject()
  @ValidateNested()
  @Type(() => TiptapContentDTO)
  content?: TiptapContentDTO;

  // ...
}
```

---

### Issue I: ìºì‹œ ë°±í•„ ê²½í•© ì¡°ê±´

**ë¬¸ì œ**: ë™ì‹œ ìš”ì²­ ì‹œ ì¤‘ë³µ ìºì‹œ ìƒì„± (DB ë¶€í•˜)

**í•´ê²° 1: ë‚™ê´€ì  ì ê¸ˆ (Optimistic Locking)**
```typescript
// backend/src/posts/entity/post.entity.ts
import { Entity, Column, VersionColumn } from 'typeorm';

@Entity()
export class Post extends BaseEntity {
  // âœ… v3.1: ë²„ì „ ì»¬ëŸ¼ ì¶”ê°€
  @VersionColumn()
  version: number;

  // ...
}
```

```typescript
// backend/src/posts/service/posts.service.ts
async getPostById(id: number): Promise<Post> {
  const post = await this.postRepository.findOne({
    where: { id },
    relations: ['tags'],
  });

  if (!post) {
    return null;
  }

  // âœ… v3.1: ìºì‹œ ë°±í•„ ì‹œ ë²„ì „ ì²´í¬
  if (!post.contentHtml) {
    try {
      await this.regenerateCache(post);
    } catch (error) {
      if (error.message.includes('optimistic lock')) {
        // ë‹¤ë¥¸ ìš”ì²­ì´ ì´ë¯¸ ìºì‹œ ìƒì„± â†’ ì¬ì¡°íšŒ
        return this.getPostById(id);
      }
      throw error;
    }
  }

  return post;
}
```

**í•´ê²° 2: Redis ë¶„ì‚° ë½ (ê³ ê¸‰)**
```typescript
// backend/src/posts/service/posts.service.ts
import { Inject } from '@nestjs/common';
import { RedisService } from '@liaoliaots/nestjs-redis';

@Injectable()
export class PostsService {
  constructor(
    @InjectRepository(Post)
    private readonly postRepository: Repository<Post>,
    @Inject(RedisService)
    private readonly redisService: RedisService,
  ) {}

  async getPostById(id: number): Promise<Post> {
    const post = await this.postRepository.findOne({
      where: { id },
      relations: ['tags'],
    });

    if (!post) {
      return null;
    }

    if (!post.contentHtml) {
      const lockKey = `cache-backfill:post:${id}`;
      const redis = this.redisService.getClient();

      // âœ… ë¶„ì‚° ë½ íšë“ (TTL 10ì´ˆ)
      const acquired = await redis.set(lockKey, '1', 'EX', 10, 'NX');

      if (acquired) {
        try {
          await this.regenerateCache(post);
        } finally {
          await redis.del(lockKey);
        }
      } else {
        // ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ê°€ ìºì‹œ ìƒì„± ì¤‘ â†’ ëŒ€ê¸° í›„ ì¬ì¡°íšŒ
        await new Promise(resolve => setTimeout(resolve, 100));
        return this.getPostById(id);
      }
    }

    return post;
  }
}
```

---

## âœ… v3.1 ì²´í¬ë¦¬ìŠ¤íŠ¸

### High Priority (ë°°í¬ í•„ìˆ˜)

- [ ] **Issue A**: TOC ì•µì»¤ ID ì£¼ì…
  - [ ] HeadingWithId Extension êµ¬í˜„ (Tiptap)
  - [ ] Markdown HTML í›„ì²˜ë¦¬ êµ¬í˜„
  - [ ] E2E í…ŒìŠ¤íŠ¸ (TOC ë„¤ë¹„ê²Œì´ì…˜)

- [ ] **Issue B**: ì¸ì¦ ë°©ì‹ í†µì¼
  - [ ] ë°±ì—”ë“œ ì¿ í‚¤ ê¸°ë°˜ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
  - [ ] JwtStrategy ì¿ í‚¤ ì¶”ì¶œ
  - [ ] CORS ì„¤ì • (credentials: true)
  - [ ] í”„ë¡ íŠ¸ API credentials: 'include'
  - [ ] localStorage ì œê±°

- [ ] **Issue C**: Edge Runtime í˜¸í™˜
  - [ ] Web Crypto APIë¡œ nonce ìƒì„±
  - [ ] Middleware í…ŒìŠ¤íŠ¸

- [ ] **Issue D**: CSP nonce ì ìš©
  - [ ] NonceContext êµ¬í˜„
  - [ ] RootLayout nonce ì „íŒŒ
  - [ ] Script/Style íƒœê·¸ nonce ì ìš©

- [ ] **Issue E**: í•œêµ­ì–´ ê²€ìƒ‰
  - [ ] pg_trgm Extension ì„¤ì¹˜
  - [ ] Migration ìˆ˜ì •
  - [ ] PostsService ILIKE ê²€ìƒ‰
  - [ ] í•œêµ­ì–´ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸

### Medium Priority (ê¶Œì¥)

- [ ] **Issue F**: DOMPurify í”„ë¡œí† ì½œ ì œí•œ
- [ ] **Issue G**: Marked ë Œë”ë§ í’ˆì§ˆ (highlight.js)
- [ ] **Issue H**: contentJson íƒ€ì… ê²€ì¦
- [ ] **Issue I**: ìºì‹œ ë°±í•„ ê²½í•© í•´ê²° (ë‚™ê´€ì  ì ê¸ˆ ë˜ëŠ” Redis)

---

## ğŸ“Š ë³€ê²½ ì‚¬í•­ ìš”ì•½

| í•­ëª© | v3.0 | v3.1 (ìˆ˜ì •) |
|------|------|------------|
| **TOC ì•µì»¤** | ID ê³„ì‚°ë§Œ | âœ… HTMLì— ID ì£¼ì… |
| **ì¸ì¦** | ì¿ í‚¤/localStorage í˜¼ì¬ | âœ… ì¿ í‚¤ í†µì¼ (HttpOnly) |
| **CSP Nonce** | í—¤ë”ë§Œ | âœ… íƒœê·¸ ì ìš© |
| **Edge Runtime** | Node crypto (ì—ëŸ¬) | âœ… Web Crypto API |
| **í•œêµ­ì–´ ê²€ìƒ‰** | english (ì‹¤íŒ¨) | âœ… pg_trgm |
| **DOMPurify** | í”„ë¡œí† ì½œ ë¬´ì œí•œ | âœ… http/https/mailtoë§Œ |
| **ìºì‹œ ë°±í•„** | ê²½í•© ì¡°ê±´ | âœ… ë‚™ê´€ì  ì ê¸ˆ |

---

**ë¬¸ì„œ ë²„ì „**: 3.1
**íŒ¨ì¹˜ ì¼ì**: 2025-12-30
**ìš°ì„ ìˆœìœ„**: High-priority 5ê°œ ì´ìŠˆëŠ” í”„ë¡œë•ì…˜ ë°°í¬ ì „ í•„ìˆ˜ ìˆ˜ì •
**ì˜ˆìƒ ì‘ì—… ì‹œê°„**: 8-12ì‹œê°„ (High Priorityë§Œ)