# ì´ë¯¸ì§€ ìŠ¤í† ë¦¬ì§€ ì „í™˜ ê°€ì´ë“œ

## í˜„ì¬ ìƒí™© ë¶„ì„

### í˜„ì¬ êµ¬í˜„ (ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œ)
```typescript
// backend/src/media/media.controller.ts
@UseInterceptors(FileInterceptor('file', {
  storage: diskStorage({
    destination: './uploads',
    filename: fileNameGenerator,
  }),
}))
```

**ë¬¸ì œì **:
- âŒ Railway/Render ê°™ì€ Serverless í™˜ê²½ì—ì„œëŠ” íŒŒì¼ ì‹œìŠ¤í…œì´ ì„ì‹œì  (ì¬ì‹œì‘ ì‹œ ì‚­ì œë¨)
- âŒ ì¸ìŠ¤í„´ìŠ¤ ê°„ íŒŒì¼ ê³µìœ  ë¶ˆê°€ (ìŠ¤ì¼€ì¼ ì•„ì›ƒ ë¶ˆê°€)
- âŒ ë°±ì—… ì–´ë ¤ì›€
- âŒ CDN ì—°ë™ ë¶ˆê°€

**í˜„ì¬ ì‚¬ìš©ì²˜**:
1. `/media/upload` - ë¸”ë¡œê·¸ ì—ë””í„° ì´ë¯¸ì§€ ì—…ë¡œë“œ
2. `/profile/image` - í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ
3. `/projects` - í”„ë¡œì íŠ¸ ì´ë¯¸ì§€ (images ë°°ì—´)

---

## ìŠ¤í† ë¦¬ì§€ ì˜µì…˜ ë¹„êµ

### ì˜µì…˜ 1: Cloudflare R2 (ê°•ë ¥ ì¶”ì²œ â­â­â­â­â­)

#### ë¬´ë£Œ í‹°ì–´
- **10GB** storage
- **1,000,000** Class A ìš”ì²­/ì›” (PUT, POST, LIST)
- **10,000,000** Class B ìš”ì²­/ì›” (GET, HEAD)
- **Egress ë¬´ë£Œ** (ëŒ€ì—­í­ ë¬´ì œí•œ!)
- S3 í˜¸í™˜ API

#### ë¹„ìš© (ë¬´ë£Œ í‹°ì–´ ì´ˆê³¼ ì‹œ)
- Storage: **$0.015/GB/ì›”**
- Class A ìš”ì²­: **$4.50/million**
- Class B ìš”ì²­: **$0.36/million**
- Egress: **$0** (ì™„ì „ ë¬´ë£Œ!)

#### ì¥ì 
- âœ… **Egress ë¹„ìš© ì—†ìŒ** (S3 ëŒ€ë¹„ ì••ë„ì  ì¥ì )
- âœ… S3 í˜¸í™˜ API (ê¸°ì¡´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¬ì‚¬ìš©)
- âœ… ê¸€ë¡œë²Œ CDN ìë™ ì—°ê²°
- âœ… Custom Domain ì§€ì›
- âœ… ë¬´ë£Œ í‹°ì–´ ë„‰ë„‰í•¨ (ê°œì¸ ë¸”ë¡œê·¸ ì¶©ë¶„)

#### ë‹¨ì 
- âŒ Cloudflare ê³„ì • í•„ìš”
- âŒ ì´ë¯¸ì§€ ë³€í™˜ ê¸°ëŠ¥ ì—†ìŒ (ì›ë³¸ ì €ì¥ë§Œ)

#### ì˜ˆìƒ ë¹„ìš© (ê°œì¸ ë¸”ë¡œê·¸)
- ì›” 100ì¥ ì—…ë¡œë“œ, 10,000 ì¡°íšŒ: **$0**
- 10GB ì´ë¯¸ì§€ ì €ì¥: **$0**
- ì›” 100,000 ì´ë¯¸ì§€ ì¡°íšŒ: **$0**

---

### ì˜µì…˜ 2: Supabase Storage

#### ë¬´ë£Œ í‹°ì–´
- **1GB** storage
- **2GB** ëŒ€ì—­í­/ì›”
- ì´ë¯¸ì§€ ë³€í™˜ í¬í•¨

#### ë¹„ìš© (Pro: $25/ì›”)
- 100GB storage
- 200GB ëŒ€ì—­í­

#### ì¥ì 
- âœ… ì´ë¯¸ì§€ ë³€í™˜ ë‚´ì¥ (ë¦¬ì‚¬ì´ì§•, í¬ë§· ë³€í™˜)
- âœ… PostgreSQLê³¼ í†µí•©
- âœ… Authì™€ í†µí•©
- âœ… RLS (Row Level Security) ì§€ì›

#### ë‹¨ì 
- âŒ ë¬´ë£Œ í‹°ì–´ ìš©ëŸ‰ ì‘ìŒ (1GB)
- âŒ ëŒ€ì—­í­ ì œí•œ (2GB/ì›”)
- âŒ í™•ì¥ ë¹„ìš© ë†’ìŒ ($25/ì›”)

---

### ì˜µì…˜ 3: Cloudinary

#### ë¬´ë£Œ í‹°ì–´
- **25GB** storage
- **25GB** ëŒ€ì—­í­/ì›”
- ì´ë¯¸ì§€ ë³€í™˜ ë¬´ì œí•œ
- CDN í¬í•¨

#### ë¹„ìš© (ì´ˆê³¼ ì‹œ)
- Plus: $99/ì›” (120GB storage, 120GB ëŒ€ì—­í­)

#### ì¥ì 
- âœ… **ì´ë¯¸ì§€ ë³€í™˜ ë§¤ìš° ê°•ë ¥** (ë¦¬ì‚¬ì´ì§•, í•„í„°, ìµœì í™”)
- âœ… CDN ìë™ ì—°ê²°
- âœ… ë¬´ë£Œ í‹°ì–´ ë„‰ë„‰í•¨
- âœ… URL ê¸°ë°˜ ë³€í™˜ (ë§¤ìš° í¸ë¦¬)

#### ë‹¨ì 
- âŒ ë¬´ë£Œ í‹°ì–´ ì œì•½ (Cloudinary ì›Œí„°ë§ˆí¬, ìƒì—…ì  ì œí•œ)
- âŒ ìœ ë£Œ ì „í™˜ ì‹œ ë¹„ì‹¸ì§ ($99/ì›”)

---

### ì˜µì…˜ 4: AWS S3 + CloudFront

#### ë¹„ìš©
- S3 Storage: $0.023/GB/ì›”
- PUT ìš”ì²­: $0.005/1000
- GET ìš”ì²­: $0.0004/1000
- **Egress: $0.09/GB** (ë§¤ìš° ë¹„ìŒˆ!)
- CloudFront: $0.085/GB (ì²« 10TB)

#### ì¥ì 
- âœ… ë§¤ìš° ì•ˆì •ì 
- âœ… ë‹¤ì–‘í•œ ê¸°ëŠ¥
- âœ… ìƒíƒœê³„ ë°©ëŒ€

#### ë‹¨ì 
- âŒ **Egress ë¹„ìš© ë†’ìŒ**
- âŒ ë¬´ë£Œ í‹°ì–´ 12ê°œì›”ë§Œ (5GB)
- âŒ ë³µì¡í•œ ì„¤ì •

#### ì˜ˆìƒ ë¹„ìš© (ê°œì¸ ë¸”ë¡œê·¸)
- 10GB ì €ì¥: $0.23
- ì›” 10GB íŠ¸ë˜í”½: $0.90
- ì´í•©: **$1.13/ì›”**

---

### ì˜µì…˜ 5: imgbb / imgur (ì„ì‹œ í•´ê²°ì±…)

#### ë¬´ë£Œ API
- imgbb: ë¬´ë£Œ API, ë¬´ì œí•œ ì—…ë¡œë“œ
- imgur: 12,500 ì—…ë¡œë“œ/ì¼

#### ì¥ì 
- âœ… ì™„ì „ ë¬´ë£Œ
- âœ… ë¹ ë¥¸ êµ¬í˜„

#### ë‹¨ì 
- âŒ ì•ˆì •ì„± ë³´ì¥ ì—†ìŒ
- âŒ ì„œë¹„ìŠ¤ ì¢…ë£Œ ìœ„í—˜
- âŒ ìƒì—…ì  ì‚¬ìš© ì œì•½
- âŒ í”„ë¡œë•ì…˜ ë¶€ì í•©

---

## ë¹„êµí‘œ

| ì„œë¹„ìŠ¤ | ë¬´ë£Œ Storage | ë¬´ë£Œ ëŒ€ì—­í­ | Egress ë¹„ìš© | ì´ë¯¸ì§€ ë³€í™˜ | ì¶”ì²œë„ |
|--------|--------------|-------------|-------------|-------------|--------|
| **Cloudflare R2** | 10GB | ë¬´ì œí•œ | $0 | âŒ | â­â­â­â­â­ |
| **Supabase** | 1GB | 2GB/ì›” | $0.09/GB | âœ… | â­â­â­ |
| **Cloudinary** | 25GB | 25GB/ì›” | $0 | âœ…âœ…âœ… | â­â­â­â­ |
| **AWS S3** | 5GB (12ê°œì›”) | 15GB (12ê°œì›”) | $0.09/GB | âŒ | â­â­ |

---

## ê¶Œì¥ ì „ëµ: Cloudflare R2 + Next.js Image Optimization

### ì•„í‚¤í…ì²˜
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend (Vercel)                              â”‚
â”‚  - Next.js Image Component                      â”‚
â”‚  - ì´ë¯¸ì§€ ìµœì í™” (WebP, AVIF)                   â”‚
â”‚  - ë¦¬ì‚¬ì´ì§•, ìºì‹±                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cloudflare R2                                  â”‚
â”‚  - ì›ë³¸ ì´ë¯¸ì§€ ì €ì¥                             â”‚
â”‚  - Public Access ë˜ëŠ” Custom Domain             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cloudflare CDN                                 â”‚
â”‚  - ê¸€ë¡œë²Œ ì—£ì§€ ìºì‹±                             â”‚
â”‚  - Egress ë¬´ë£Œ                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì™œ ì´ ì¡°í•©ì¸ê°€?
1. **R2**: ì›ë³¸ ì €ì¥ (Egress ë¬´ë£Œ!)
2. **Next.js Image**: ì‹¤ì‹œê°„ ì´ë¯¸ì§€ ìµœì í™” (Vercel ë¬´ë£Œ)
3. **Cloudflare CDN**: ê¸€ë¡œë²Œ ë°°í¬ (ìë™)

**ê²°ê³¼**: ì™„ì „ ë¬´ë£Œ + ìµœê³  ì„±ëŠ¥ ğŸš€

---

## êµ¬í˜„ ê°€ì´ë“œ: Cloudflare R2

### Step 1: Cloudflare R2 ì„¤ì •

#### 1.1. R2 ë²„í‚· ìƒì„±
```bash
# Cloudflare Dashboard
1. R2 ë©”ë‰´ ì ‘ì†
2. "Create bucket" í´ë¦­
3. ë²„í‚· ì´ë¦„: my-blog-images
4. Location: Automatic (ê°€ì¥ ê°€ê¹Œìš´ ë¦¬ì „)
5. "Create bucket" ì™„ë£Œ
```

#### 1.2. API Token ìƒì„±
```bash
# Cloudflare Dashboard â†’ R2 â†’ Manage R2 API Tokens
1. "Create API token" í´ë¦­
2. Permission: Object Read & Write
3. Specific bucket: my-blog-images
4. TTL: Forever (ë˜ëŠ” ì›í•˜ëŠ” ê¸°ê°„)
5. ìƒì„±ëœ Access Key ID, Secret Access Key ë³µì‚¬
```

#### 1.3. Public Access ì„¤ì • (ì˜µì…˜ 1)
```bash
# Cloudflare Dashboard â†’ R2 â†’ my-blog-images â†’ Settings
1. "Allow Access" í´ë¦­
2. Public R2.dev subdomain í™œì„±í™”
3. ìƒì„±ëœ URL ë³µì‚¬: https://pub-xxxxx.r2.dev
```

**ë˜ëŠ”**

#### 1.4. Custom Domain ì„¤ì • (ì˜µì…˜ 2 - ê¶Œì¥)
```bash
# Cloudflare Dashboard â†’ R2 â†’ my-blog-images â†’ Settings â†’ Custom Domains
1. "Connect Domain" í´ë¦­
2. ë„ë©”ì¸ ì…ë ¥: images.yourblog.com
3. DNS ë ˆì½”ë“œ ìë™ ìƒì„±
4. ì™„ë£Œ í›„ ì‚¬ìš©: https://images.yourblog.com
```

---

### Step 2: Backend ì½”ë“œ ìˆ˜ì •

#### 2.1. íŒ¨í‚¤ì§€ ì„¤ì¹˜
```bash
cd backend
npm install @aws-sdk/client-s3
npm install --save-dev @types/multer
```

#### 2.2. í™˜ê²½ë³€ìˆ˜ ì„¤ì •
```env
# backend/.env
CLOUDFLARE_R2_ENDPOINT=https://xxxxx.r2.cloudflarestorage.com
CLOUDFLARE_R2_ACCESS_KEY_ID=your-access-key-id
CLOUDFLARE_R2_SECRET_ACCESS_KEY=your-secret-access-key
CLOUDFLARE_R2_BUCKET_NAME=my-blog-images
CLOUDFLARE_R2_PUBLIC_URL=https://pub-xxxxx.r2.dev
# ë˜ëŠ” Custom Domain ì‚¬ìš© ì‹œ:
# CLOUDFLARE_R2_PUBLIC_URL=https://images.yourblog.com
```

#### 2.3. R2 Storage Service ìƒì„±
```typescript
// backend/src/media/r2-storage.service.ts
import { Injectable } from '@nestjs/common';
import { S3Client, PutObjectCommand, DeleteObjectCommand } from '@aws-sdk/client-s3';
import { ConfigService } from '@nestjs/config';

@Injectable()
export class R2StorageService {
  private s3Client: S3Client;
  private bucketName: string;
  private publicUrl: string;

  constructor(private configService: ConfigService) {
    this.s3Client = new S3Client({
      region: 'auto',
      endpoint: this.configService.get<string>('CLOUDFLARE_R2_ENDPOINT'),
      credentials: {
        accessKeyId: this.configService.get<string>('CLOUDFLARE_R2_ACCESS_KEY_ID'),
        secretAccessKey: this.configService.get<string>('CLOUDFLARE_R2_SECRET_ACCESS_KEY'),
      },
    });
    this.bucketName = this.configService.get<string>('CLOUDFLARE_R2_BUCKET_NAME');
    this.publicUrl = this.configService.get<string>('CLOUDFLARE_R2_PUBLIC_URL');
  }

  /**
   * ì´ë¯¸ì§€ ì—…ë¡œë“œ
   */
  async uploadImage(file: Express.Multer.File, folder: string = ''): Promise<string> {
    const timestamp = Date.now();
    const randomSuffix = Math.round(Math.random() * 1e9);
    const extension = file.originalname.split('.').pop();
    const fileName = folder
      ? `${folder}/${timestamp}-${randomSuffix}.${extension}`
      : `${timestamp}-${randomSuffix}.${extension}`;

    await this.s3Client.send(
      new PutObjectCommand({
        Bucket: this.bucketName,
        Key: fileName,
        Body: file.buffer,
        ContentType: file.mimetype,
      })
    );

    return `${this.publicUrl}/${fileName}`;
  }

  /**
   * ì´ë¯¸ì§€ ì‚­ì œ
   */
  async deleteImage(imageUrl: string): Promise<void> {
    // URLì—ì„œ key ì¶”ì¶œ
    const key = imageUrl.replace(`${this.publicUrl}/`, '');

    await this.s3Client.send(
      new DeleteObjectCommand({
        Bucket: this.bucketName,
        Key: key,
      })
    );
  }
}
```

#### 2.4. Media Controller ìˆ˜ì •
```typescript
// backend/src/media/media.controller.ts
import { Controller, Post, UploadedFile, UseGuards, UseInterceptors, BadRequestException } from '@nestjs/common';
import { ApiBearerAuth, ApiBody, ApiConsumes, ApiOperation, ApiTags } from '@nestjs/swagger';
import { FileInterceptor } from '@nestjs/platform-express';
import { JwtRoleGuard } from '../auth/common/jwt-role.guard';
import { Roles } from '../auth/decorator/auth-role.decorator';
import { R2StorageService } from './r2-storage.service';

@ApiTags('Media')
@Controller('media')
export class MediaController {
  constructor(private readonly r2StorageService: R2StorageService) {}

  @Post('upload')
  @ApiBearerAuth('JWT-auth')
  @UseGuards(JwtRoleGuard)
  @Roles('admin')
  @ApiConsumes('multipart/form-data')
  @ApiBody({
    schema: {
      type: 'object',
      properties: {
        file: { type: 'string', format: 'binary' }
      }
    }
  })
  @UseInterceptors(FileInterceptor('file', {
    limits: {
      fileSize: 5 * 1024 * 1024, // 5MB ì œí•œ
    },
    fileFilter: (req, file, cb) => {
      // ì´ë¯¸ì§€ íŒŒì¼ë§Œ í—ˆìš©
      if (!file.mimetype.match(/^image\/(jpeg|jpg|png|gif|webp|avif)$/)) {
        return cb(new BadRequestException('Only image files are allowed'), false);
      }
      cb(null, true);
    },
  }))
  @ApiOperation({ summary: 'ì´ë¯¸ì§€ ì—…ë¡œë“œ (ê´€ë¦¬ì)' })
  async uploadFile(@UploadedFile() file: Express.Multer.File) {
    if (!file) {
      throw new BadRequestException('No file uploaded');
    }

    const url = await this.r2StorageService.uploadImage(file, 'blog');
    return { url };
  }
}
```

#### 2.5. Profile Controller ìˆ˜ì •
```typescript
// backend/src/profile/profile.controller.ts
import { Controller, Get, Put, Body, Post, UploadedFile, UseInterceptors, UseGuards, BadRequestException } from '@nestjs/common';
import { ApiBearerAuth, ApiBody, ApiConsumes, ApiOperation, ApiTags } from '@nestjs/swagger';
import { FileInterceptor } from '@nestjs/platform-express';
import { ProfileService } from './profile.service';
import { UpdateProfileDto } from './dto/update-profile.dto';
import { JwtRoleGuard } from '../auth/common/jwt-role.guard';
import { Roles } from '../auth/decorator/auth-role.decorator';
import { R2StorageService } from '../media/r2-storage.service';

@ApiTags('Profile')
@Controller('profile')
export class ProfileController {
  constructor(
    private readonly profileService: ProfileService,
    private readonly r2StorageService: R2StorageService,
  ) {}

  @Get()
  @ApiOperation({ summary: 'í”„ë¡œí•„ ì¡°íšŒ' })
  async getProfile() {
    const profile = await this.profileService.getProfile();
    return { data: profile };
  }

  @Put()
  @ApiBearerAuth('JWT-auth')
  @UseGuards(JwtRoleGuard)
  @Roles('admin')
  @ApiOperation({ summary: 'í”„ë¡œí•„ ì—…ë°ì´íŠ¸ (ê´€ë¦¬ì)' })
  async updateProfile(@Body() updateDto: UpdateProfileDto) {
    const profile = await this.profileService.updateProfile(updateDto);
    return { data: profile };
  }

  @Post('image')
  @ApiBearerAuth('JWT-auth')
  @UseGuards(JwtRoleGuard)
  @Roles('admin')
  @ApiConsumes('multipart/form-data')
  @ApiBody({
    schema: {
      type: 'object',
      properties: {
        image: { type: 'string', format: 'binary' }
      }
    }
  })
  @UseInterceptors(FileInterceptor('image', {
    limits: {
      fileSize: 2 * 1024 * 1024, // 2MB ì œí•œ
    },
    fileFilter: (req, file, cb) => {
      if (!file.mimetype.match(/^image\/(jpeg|jpg|png|gif|webp|avif)$/)) {
        return cb(new BadRequestException('Only image files are allowed'), false);
      }
      cb(null, true);
    },
  }))
  @ApiOperation({ summary: 'í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ (ê´€ë¦¬ì)' })
  async uploadProfileImage(@UploadedFile() file: Express.Multer.File) {
    if (!file) {
      throw new BadRequestException('No file uploaded');
    }

    const imageUrl = await this.r2StorageService.uploadImage(file, 'profile');

    // í”„ë¡œí•„ì— ì´ë¯¸ì§€ URL ì—…ë°ì´íŠ¸
    await this.profileService.updateProfile({ profileImage: imageUrl });

    return { imageUrl };
  }
}
```

#### 2.6. Media Module ìˆ˜ì •
```typescript
// backend/src/media/media.module.ts
import { Module } from '@nestjs/common';
import { MediaController } from './media.controller';
import { R2StorageService } from './r2-storage.service';

@Module({
  controllers: [MediaController],
  providers: [R2StorageService],
  exports: [R2StorageService], // ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œ ì‚¬ìš© ê°€ëŠ¥
})
export class MediaModule {}
```

#### 2.7. Profile Module ìˆ˜ì •
```typescript
// backend/src/profile/profile.module.ts
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { ProfileController } from './profile.controller';
import { ProfileService } from './profile.service';
import { Profile } from './profile.entity';
import { MediaModule } from '../media/media.module'; // ì¶”ê°€

@Module({
  imports: [
    TypeOrmModule.forFeature([Profile]),
    MediaModule, // ì¶”ê°€
  ],
  controllers: [ProfileController],
  providers: [ProfileService],
  exports: [ProfileService],
})
export class ProfileModule {}
```

---

### Step 3: Frontend ìˆ˜ì • (ì´ë¯¸ì§€ ìµœì í™”)

#### 3.1. next.config.js ì„¤ì •
```javascript
// frontend/next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'pub-*.r2.dev', // R2 public URL
      },
      {
        protocol: 'https',
        hostname: 'images.yourblog.com', // Custom Domain (ìˆì„ ê²½ìš°)
      },
    ],
    formats: ['image/avif', 'image/webp'],
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
  },
}

module.exports = nextConfig
```

#### 3.2. ì´ë¯¸ì§€ ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
```typescript
// frontend/components/blog/blog-image.tsx
import Image from 'next/image'

interface BlogImageProps {
  src: string
  alt: string
  width?: number
  height?: number
  priority?: boolean
}

export function BlogImage({ src, alt, width = 1200, height = 630, priority = false }: BlogImageProps) {
  return (
    <div className="relative w-full h-auto">
      <Image
        src={src}
        alt={alt}
        width={width}
        height={height}
        priority={priority}
        className="rounded-lg object-cover"
        sizes="(max-width: 768px) 100vw, (max-width: 1200px) 80vw, 1200px"
      />
    </div>
  )
}
```

#### 3.3. ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©
```typescript
// frontend/app/blog/[slug]/page.tsx
import { BlogImage } from '@/components/blog/blog-image'

export default async function BlogPost({ params }) {
  const post = await getPost(params.slug)

  return (
    <article>
      <BlogImage
        src={post.thumbnail}
        alt={post.title}
        priority={true}
      />
      <div dangerouslySetInnerHTML={{ __html: post.content }} />
    </article>
  )
}
```

---

### Step 4: ë°°í¬ ë° í™˜ê²½ë³€ìˆ˜ ì„¤ì •

#### Railway/Render í™˜ê²½ë³€ìˆ˜
```env
CLOUDFLARE_R2_ENDPOINT=https://xxxxx.r2.cloudflarestorage.com
CLOUDFLARE_R2_ACCESS_KEY_ID=your-access-key-id
CLOUDFLARE_R2_SECRET_ACCESS_KEY=your-secret-access-key
CLOUDFLARE_R2_BUCKET_NAME=my-blog-images
CLOUDFLARE_R2_PUBLIC_URL=https://pub-xxxxx.r2.dev
```

#### Vercel í™˜ê²½ë³€ìˆ˜
```env
NEXT_PUBLIC_API_URL=https://your-backend.railway.app
```

---

## ë§ˆì´ê·¸ë ˆì´ì…˜: ê¸°ì¡´ ë¡œì»¬ ì´ë¯¸ì§€ â†’ R2

### ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸
```typescript
// backend/scripts/migrate-images-to-r2.ts
import { S3Client, PutObjectCommand } from '@aws-sdk/client-s3';
import * as fs from 'fs';
import * as path from 'path';
import { config } from 'dotenv';

config();

const s3Client = new S3Client({
  region: 'auto',
  endpoint: process.env.CLOUDFLARE_R2_ENDPOINT,
  credentials: {
    accessKeyId: process.env.CLOUDFLARE_R2_ACCESS_KEY_ID,
    secretAccessKey: process.env.CLOUDFLARE_R2_SECRET_ACCESS_KEY,
  },
});

const bucketName = process.env.CLOUDFLARE_R2_BUCKET_NAME;
const uploadsDir = './uploads';

async function migrateImages() {
  const files = fs.readdirSync(uploadsDir);

  for (const file of files) {
    const filePath = path.join(uploadsDir, file);
    const fileContent = fs.readFileSync(filePath);
    const mimeType = getMimeType(file);

    console.log(`Uploading ${file}...`);

    await s3Client.send(
      new PutObjectCommand({
        Bucket: bucketName,
        Key: `migrated/${file}`,
        Body: fileContent,
        ContentType: mimeType,
      })
    );

    console.log(`âœ“ Uploaded ${file}`);
  }

  console.log('Migration complete!');
}

function getMimeType(fileName: string): string {
  const ext = fileName.split('.').pop()?.toLowerCase();
  const mimeTypes: Record<string, string> = {
    jpg: 'image/jpeg',
    jpeg: 'image/jpeg',
    png: 'image/png',
    gif: 'image/gif',
    webp: 'image/webp',
    avif: 'image/avif',
  };
  return mimeTypes[ext] || 'application/octet-stream';
}

migrateImages().catch(console.error);
```

### ì‹¤í–‰
```bash
cd backend
npx ts-node scripts/migrate-images-to-r2.ts
```

---

## ëŒ€ì•ˆ: Cloudinary (ì´ë¯¸ì§€ ë³€í™˜ í•„ìš” ì‹œ)

### Cloudinary ì„¤ì •

#### 1. Cloudinary ê°€ì… ë° ì„¤ì •
```bash
# Cloudinary Dashboard
1. ë¬´ë£Œ ê³„ì • ê°€ì…: https://cloudinary.com
2. Dashboardì—ì„œ í™•ì¸:
   - Cloud Name
   - API Key
   - API Secret
```

#### 2. íŒ¨í‚¤ì§€ ì„¤ì¹˜
```bash
npm install cloudinary
```

#### 3. Cloudinary Service ìƒì„±
```typescript
// backend/src/media/cloudinary.service.ts
import { Injectable } from '@nestjs/common';
import { v2 as cloudinary } from 'cloudinary';
import { ConfigService } from '@nestjs/config';

@Injectable()
export class CloudinaryService {
  constructor(private configService: ConfigService) {
    cloudinary.config({
      cloud_name: this.configService.get<string>('CLOUDINARY_CLOUD_NAME'),
      api_key: this.configService.get<string>('CLOUDINARY_API_KEY'),
      api_secret: this.configService.get<string>('CLOUDINARY_API_SECRET'),
    });
  }

  async uploadImage(file: Express.Multer.File, folder: string = 'blog'): Promise<string> {
    return new Promise((resolve, reject) => {
      cloudinary.uploader.upload_stream(
        {
          folder,
          resource_type: 'image',
          transformation: [
            { width: 1920, height: 1080, crop: 'limit' }, // ìµœëŒ€ í¬ê¸° ì œí•œ
            { quality: 'auto', fetch_format: 'auto' }, // ìë™ ìµœì í™”
          ],
        },
        (error, result) => {
          if (error) return reject(error);
          resolve(result.secure_url);
        }
      ).end(file.buffer);
    });
  }

  async deleteImage(publicId: string): Promise<void> {
    await cloudinary.uploader.destroy(publicId);
  }
}
```

#### 4. URL ê¸°ë°˜ ì´ë¯¸ì§€ ë³€í™˜ (Cloudinary ì¥ì )
```typescript
// ì›ë³¸
https://res.cloudinary.com/demo/image/upload/sample.jpg

// ë¦¬ì‚¬ì´ì§• (300x300)
https://res.cloudinary.com/demo/image/upload/w_300,h_300,c_fill/sample.jpg

// WebP ë³€í™˜
https://res.cloudinary.com/demo/image/upload/f_webp/sample.jpg

// í’ˆì§ˆ ì¡°ì • (80%)
https://res.cloudinary.com/demo/image/upload/q_80/sample.jpg

// ë³µí•© ë³€í™˜
https://res.cloudinary.com/demo/image/upload/w_300,h_300,c_fill,f_webp,q_auto/sample.jpg
```

---

## ë¹„ìš© ì‹œë®¬ë ˆì´ì…˜ (1ë…„)

### ì‹œë‚˜ë¦¬ì˜¤: ê°œì¸ ë¸”ë¡œê·¸ (ì›” 50ì¥ ì—…ë¡œë“œ, 10,000 ì¡°íšŒ)

#### Cloudflare R2
- Storage: 1GB (50ì¥ Ã— 20MB Ã— 12ê°œì›”) = 600MB
- Class A ìš”ì²­: 600 uploads/ë…„ = ë¬´ë£Œ
- Class B ìš”ì²­: 120,000 views/ë…„ = ë¬´ë£Œ
- Egress: 12GB (10,000 views Ã— 1MB Ã— 12ê°œì›”) = **ë¬´ë£Œ**
- **ì—°ê°„ ë¹„ìš©: $0**

#### AWS S3 + CloudFront
- Storage: 1GB Ã— 12ê°œì›” = $0.28
- PUT: 600 uploads = $0.003
- GET: 120,000 views = $0.048
- Egress: 12GB = **$10.80**
- **ì—°ê°„ ë¹„ìš©: $11.13**

#### Cloudinary (ë¬´ë£Œ í‹°ì–´)
- Storage: 1GB = ë¬´ë£Œ
- Transformations: ë¬´ì œí•œ = ë¬´ë£Œ
- Bandwidth: 12GB = ë¬´ë£Œ
- **ì—°ê°„ ë¹„ìš©: $0** (ë¬´ë£Œ í‹°ì–´ ë‚´)

### ê²°ë¡ 
- **Cloudflare R2**: Egress ë¬´ë£Œ â†’ ëŒ€ê·œëª¨ íŠ¸ë˜í”½ì—ë„ ë¹„ìš© $0
- **AWS S3**: Egress ë¹„ì‹¸ì„œ íŠ¸ë˜í”½ ì¦ê°€ ì‹œ ë¹„ìš© í­ì¦
- **Cloudinary**: ë¬´ë£Œ í‹°ì–´ 25GBê¹Œì§€ ì™„ì „ ë¬´ë£Œ, ì´ë¯¸ì§€ ë³€í™˜ ê°•ë ¥

---

## ìµœì¢… ê¶Œì¥ ì‚¬í•­

### ë‹¨ê³„ë³„ ì „í™˜ ì „ëµ

#### Phase 1: ì¦‰ì‹œ (ê°œë°œ í™˜ê²½)
- âœ… **Cloudflare R2** ì‚¬ìš©
- ì´ìœ : ë¬´ë£Œ, Egress ë¬´ë£Œ, S3 í˜¸í™˜

#### Phase 2: íŠ¸ë˜í”½ ì¦ê°€ ì‹œ
- âœ… **Cloudflare R2** ê³„ì† ì‚¬ìš©
- ì´ë¯¸ì§€ ìµœì í™”ëŠ” Next.js Imageì— ë§¡ê¹€

#### Phase 3: ì´ë¯¸ì§€ ë³€í™˜ í•„ìš” ì‹œ
- âœ… **Cloudinary** ì¶”ê°€ (ë¬´ë£Œ í‹°ì–´)
- R2ì— ì›ë³¸, Cloudinaryë¡œ ë³€í™˜ëœ ì´ë¯¸ì§€ ì œê³µ

#### Phase 4: ëŒ€ê·œëª¨ ì„œë¹„ìŠ¤
- âœ… **Cloudflare R2** + **Cloudflare Images** ($5/ì›” for 100,000 variants)
- ë˜ëŠ” Cloudinary Pro ($99/ì›”)

---

## ì²´í¬ë¦¬ìŠ¤íŠ¸

### êµ¬í˜„ ì „
- [ ] Cloudflare ê³„ì • ìƒì„±
- [ ] R2 ë²„í‚· ìƒì„±
- [ ] API Token ìƒì„±
- [ ] Public URL ë˜ëŠ” Custom Domain ì„¤ì •

### Backend ìˆ˜ì •
- [ ] `@aws-sdk/client-s3` ì„¤ì¹˜
- [ ] `R2StorageService` ìƒì„±
- [ ] `MediaController` ìˆ˜ì •
- [ ] `ProfileController` ìˆ˜ì •
- [ ] í™˜ê²½ë³€ìˆ˜ ì„¤ì •

### Frontend ìˆ˜ì •
- [ ] `next.config.js` ì´ë¯¸ì§€ ë„ë©”ì¸ ì¶”ê°€
- [ ] Next.js Image ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
- [ ] í™˜ê²½ë³€ìˆ˜ ì„¤ì •

### ë§ˆì´ê·¸ë ˆì´ì…˜
- [ ] ê¸°ì¡´ ë¡œì»¬ ì´ë¯¸ì§€ R2ë¡œ ì—…ë¡œë“œ
- [ ] DBì˜ ì´ë¯¸ì§€ URL ì—…ë°ì´íŠ¸
- [ ] ë¡œì»¬ uploads í´ë” ì‚­ì œ

### ë°°í¬
- [ ] Railway/Render í™˜ê²½ë³€ìˆ˜ ì„¤ì •
- [ ] Vercel í™˜ê²½ë³€ìˆ˜ ì„¤ì •
- [ ] ì´ë¯¸ì§€ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸
- [ ] ì´ë¯¸ì§€ ì¡°íšŒ í…ŒìŠ¤íŠ¸

---

## ì°¸ê³  ë§í¬

- [Cloudflare R2 Docs](https://developers.cloudflare.com/r2/)
- [AWS SDK for JavaScript v3](https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/)
- [Next.js Image Optimization](https://nextjs.org/docs/app/building-your-application/optimizing/images)
- [Cloudinary Docs](https://cloudinary.com/documentation)

---

ì´ ê°€ì´ë“œë¥¼ ë”°ë¼í•˜ë©´ **ì™„ì „ ë¬´ë£Œ**ë¡œ ì•ˆì •ì ì¸ ì´ë¯¸ì§€ ìŠ¤í† ë¦¬ì§€ë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ğŸ‰
